<!DOCTYPE html>
<html>
  <head>
    <title> PPOL670 | Introduction to Data Science for Public Policy   Week 6       Exploratory Data Anlaysis and Modeling</title>
    <meta charset="utf-8">
    <meta name="author" content="  Prof. Eric Dunford  ◆  Georgetown University  ◆  McCourt School of Public Policy  ◆  eric.dunford@georgetown.edu" />
    <script src="libs/kePrint-0.0.1/kePrint.js"></script>
    <link rel="stylesheet" href="gu-theme.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">
class: center, middle, inverse, title-slide

# <font class = "title-panel"> PPOL670 | Introduction to Data Science for Public Policy </font> <font size=6, face="bold"> Week 6 </font> <br> <br> <font size=100, face="bold"> Exploratory Data Anlaysis and Modeling </font>
### <font class = "title-footer">  Prof. Eric Dunford  ◆  Georgetown University  ◆  McCourt School of Public Policy  ◆  <a href="mailto:eric.dunford@georgetown.edu" class="email">eric.dunford@georgetown.edu</a></font>

---




layout: true

&lt;div class="slide-footer"&gt;&lt;span&gt; 
PPOL670 | Introduction to Data Science for Public Policy

&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;

Week 6 &lt;!-- Week of the Footer Here --&gt;

&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;

EDA and Modeling &lt;!-- Title of the lecture here --&gt;

&lt;/span&gt;&lt;/div&gt; 

---
class: outline

# Outline for Today 

- Briefly discuss expectations regarding **Memo 2**

- Delve into **Exploratory Data Analysis** techniques

- linear **modeling**

- Talk about **Pre-processing data** 

---

# General

- Do the readings

  + Specifically the readings on RMarkdown (week 2)

&lt;br&gt;

- "Diligent De-Bugging" Clause 
  
  + Google before you ask
  
  + Prove to us what you've done.
  
&lt;br&gt;

- Reproducibility and Transparency: more than just concepts. They impact your grade.



---

# Thoughts on Memo 1

- "Traditional"
  
  + Statistical analysis (e.g. diff-in-diff)
  
  + Using traditional sources (e.g. survey data)
  
--

- Careful! This is not a stats course. This is a data science course. Make sure to use what we've learned in class on your projects.

--

- More precise discussion about data 

- "Potential Issues" need to actually be problems. 

---

#  Memo 2

For Memo 2, please:

- Restate the problem and your hypothesis/expectations for the project

- Outline what you plan to do: visualizations, predictive analysis, interactive applications, text as data, 

- Provide a description of the analysis and tools your group plans on using: 

- **Key question to ask yourself**: are we employing concepts we learned in _this_ course? If the answer is "no", then back to the drawing board. 

---

class: newsection

# Exploratory Data Analysis

---

### Exploratory Data Analysis (EDA)

EDA is an **iterative cycle**:

1. **Generate** questions about your data.

2. Search for answers by **visualising**, **transforming**, and **modelling** your data.

3. Use what you learn to **refine** your questions and/or generate new questions.

EDA is not a formal process with a strict set of rules, it's a state of mind. Feel free to investigate every idea that occurs to you. Some will work and offer valuable insights, others won't

---

### Asking Questions

- EDA is fundamentally a creative process. 

- The key to asking _quality_ questions is to generate a large _quantity_ of questions.

--

&lt;br&gt;&lt;br&gt;

There is no rule about which questions to ask, but here are two important ones you should always ask: 

1. What type of **variation** occurs within my variables?

2. What type of **covariation** occurs between my variables?

---

### Data

To give you a feel for the EDA process, I'll look through new (to me) data on crimes committed in Chicago from 2012 to 2016. 

These data can be downloaded from the [`crimedata` package](https://cran.r-project.org/web/packages/crimedata/crimedata.pdf), which provides an `R` wrapper for the FBI Crime data API that we encountered last week. 


```r
crimes = crimedata::get_crime_data(years=2012:2016,
                                   cities="Chicago",
*                                  type = "sample")
```

More information on these data can be found [here](https://osf.io/zyaqn/).

---


```r
crimes = read_csv("Data/chicago-crime-data.csv")
glimpse(crimes)
```

```
## Observations: 14,366
## Variables: 12
## $ uid               &lt;int&gt; 1957842, 1958151, 1958164, 1958184, 1958359, 1…
## $ city_name         &lt;chr&gt; "Chicago", "Chicago", "Chicago", "Chicago", "C…
## $ offense_code      &lt;chr&gt; "26C", "13A", "12A", "13B", "13B", "12A", "26C…
## $ offense_type      &lt;chr&gt; "impersonation", "aggravated assault", "person…
## $ offense_group     &lt;chr&gt; "fraud offenses (except counterfeiting/forgery…
## $ offense_against   &lt;chr&gt; "property", "persons", "property", "persons", …
## $ date_single       &lt;dttm&gt; 2012-01-01 00:00:00, 2012-01-01 01:20:00, 201…
## $ longitude         &lt;dbl&gt; -87.67936, -87.63387, -87.63898, -87.66158, -8…
## $ latitude          &lt;dbl&gt; 41.76046, 41.84550, 41.79077, 41.77162, 41.799…
## $ location_type     &lt;chr&gt; "residence", "vehicle parking", "street", "res…
## $ location_category &lt;chr&gt; "residence", "open space", "street", "residenc…
## $ census_block      &lt;dbl&gt; 1.703166e+14, 1.703134e+14, 1.703183e+14, 1.70…
```

---

class:shrink

### Distribution


```r
crimes %&gt;% select(offense_code:location_category) %&gt;% skimr::skim(.) 
```

```
## Skim summary statistics
##  n obs: 14366 
##  n variables: 9 
## 
## ── Variable type:character ────────────────────────────
##           variable missing complete     n min max empty n_unique
##  location_category      18    14348 14366   5  14     0       13
##      location_type      18    14348 14366   3  20     0       32
##    offense_against       0    14366 14366   5   8     0        4
##       offense_code       0    14366 14366   3   3     0       43
##      offense_group       0    14366 14366   5  74     0       26
##       offense_type       0    14366 14366   5  74     0       43
## 
## ── Variable type:numeric ──────────────────────────────
##   variable missing complete     n   mean    sd     p0    p25    p50    p75
##   latitude       0    14366 14366  41.84 0.086  41.64  41.77  41.86  41.91
##  longitude       0    14366 14366 -87.67 0.059 -87.93 -87.72 -87.67 -87.63
##    p100     hist
##   42.02 ▁▃▇▅▆▇▅▂
##  -87.53 ▁▁▁▃▆▇▅▁
## 
## ── Variable type:POSIXct ──────────────────────────────
##     variable missing complete     n        min        max     median
##  date_single       0    14366 14366 2012-01-01 2016-12-31 2014-04-27
##  n_unique
##     13946
```

---

### Variation


```r
crimes %&gt;% 
  mutate(location_category = fct_infreq(location_category)) %&gt;% 
  ggplot(aes(location_category)) + 
  geom_bar() +
  coord_flip()
```

&lt;img src="lecture-week-06_EDA-and-Modeling_ppol670_files/figure-html/unnamed-chunk-4-1.png" style="display: block; margin: auto;" /&gt;

---

### Variation


```r
crimes %&gt;% 
  mutate(offense_group = fct_infreq(offense_group)) %&gt;% 
  ggplot(aes(offense_group)) + 
  geom_bar() +
  coord_flip()
```

&lt;img src="lecture-week-06_EDA-and-Modeling_ppol670_files/figure-html/unnamed-chunk-5-1.png" style="display: block; margin: auto;" /&gt;

---

### Variation


```r
crimes %&gt;% 
  mutate(offense_against = fct_infreq(offense_against)) %&gt;% 
  ggplot(aes(offense_against)) + 
  geom_bar() +
  coord_flip()
```

&lt;img src="lecture-week-06_EDA-and-Modeling_ppol670_files/figure-html/unnamed-chunk-6-1.png" style="display: block; margin: auto;" /&gt;

---

### Spatial Variation


```r
crimes %&gt;% 
  ggplot(aes(longitude,latitude)) +
  geom_point(alpha=.1,color="darkred") +
  theme_minimal()
```

&lt;img src="lecture-week-06_EDA-and-Modeling_ppol670_files/figure-html/unnamed-chunk-7-1.png" style="display: block; margin: auto;" /&gt;

---

### Spatial Variation


```r
crimes %&gt;% 
  ggplot(aes(longitude,latitude)) +
  geom_point(alpha=.1,color="darkred") +
  geom_density_2d() +
  theme_minimal() 
```

&lt;img src="lecture-week-06_EDA-and-Modeling_ppol670_files/figure-html/unnamed-chunk-8-1.png" style="display: block; margin: auto;" /&gt;

---


```r
crimes %&gt;% 
  ggplot(aes(longitude,latitude)) +
  stat_density_2d(aes(fill = stat(level)), geom = "polygon") +
  scale_fill_viridis_c() +
  theme_minimal() 
```

&lt;img src="lecture-week-06_EDA-and-Modeling_ppol670_files/figure-html/unnamed-chunk-9-1.png" style="display: block; margin: auto;" /&gt;

---

### Temporal Variation



```r
crimes &lt;- crimes %&gt;% mutate(date=lubridate::ymd_hms(date_single)) 

crimes %&gt;% 
  ggplot(aes(date)) +
  geom_histogram(color="white",bins=50,fill="black") +
  theme_minimal()
```

&lt;img src="lecture-week-06_EDA-and-Modeling_ppol670_files/figure-html/unnamed-chunk-10-1.png" style="display: block; margin: auto;" /&gt;

---


```r
crimes &lt;- 
  crimes %&gt;% 
  mutate(month = lubridate::round_date(date,unit = 'month')) 

crimes %&gt;% 
  group_by(month) %&gt;% 
  count()
```

```
## # A tibble: 61 x 2
## # Groups:   month [61]
##    month                   n
##    &lt;dttm&gt;              &lt;int&gt;
##  1 2012-01-01 00:00:00   135
##  2 2012-02-01 00:00:00   223
##  3 2012-03-01 00:00:00   272
##  4 2012-04-01 00:00:00   297
##  5 2012-05-01 00:00:00   299
##  6 2012-06-01 00:00:00   289
##  7 2012-07-01 00:00:00   316
##  8 2012-08-01 00:00:00   318
##  9 2012-09-01 00:00:00   269
## 10 2012-10-01 00:00:00   275
## # … with 51 more rows
```

---


```r
crimes %&gt;% 
  group_by(month) %&gt;% 
  count() %&gt;% 
  ggplot(aes(month,n)) +
  geom_line() + geom_point() +
  ylim(0,400)
```

&lt;img src="lecture-week-06_EDA-and-Modeling_ppol670_files/figure-html/unnamed-chunk-12-1.png" style="display: block; margin: auto;" /&gt;

---


```r
crimes %&gt;% 
  group_by(month) %&gt;% 
  count() %&gt;% 
  ggplot(aes(month,n)) +
  geom_line() + geom_point() +
  ylim(0,400) +
  geom_smooth(method="lm")
```

&lt;img src="lecture-week-06_EDA-and-Modeling_ppol670_files/figure-html/unnamed-chunk-13-1.png" style="display: block; margin: auto;" /&gt;

---


```r
crimes %&gt;% 
  group_by(month) %&gt;% 
  count() %&gt;% 
  ggplot(aes(month,n)) +
  geom_line() + geom_point() +
  ylim(0,400) +
* geom_smooth(method="loess")
```

&lt;img src="lecture-week-06_EDA-and-Modeling_ppol670_files/figure-html/unnamed-chunk-14-1.png" style="display: block; margin: auto;" /&gt;

---


```r
crimes %&gt;% 
  mutate(date = lubridate::round_date(date,unit="day")) %&gt;% 
  group_by(date) %&gt;% 
  count() %&gt;% 
  ggplot(aes(date,n)) +
  geom_line(alpha=.1) + geom_point(alpha=.7) +
  geom_smooth(method="loess")
```

&lt;img src="lecture-week-06_EDA-and-Modeling_ppol670_files/figure-html/unnamed-chunk-15-1.png" style="display: block; margin: auto;" /&gt;

---


```r
crimes %&gt;% 
  mutate(date = lubridate::year(date)) %&gt;% 
  ggplot(aes(date)) +
  geom_bar(fill="steelblue")
```

&lt;img src="lecture-week-06_EDA-and-Modeling_ppol670_files/figure-html/unnamed-chunk-16-1.png" style="display: block; margin: auto;" /&gt;

---


```r
crimes %&gt;% 
  group_by(month,location_category) %&gt;% 
  count() %&gt;% 
  ggplot(aes(month,n,color=location_category)) +
  geom_line() + geom_point() +
* gghighlight::gghighlight(max(n)&gt;30) +
  theme(legend.position="none")
```

&lt;img src="lecture-week-06_EDA-and-Modeling_ppol670_files/figure-html/unnamed-chunk-17-1.png" style="display: block; margin: auto;" /&gt;

---


```r
crimes %&gt;% 
  filter(location_category %in% c("street","residence")) %&gt;% 
   ggplot(aes(longitude,latitude,color = location_category)) +
  geom_point(alpha=.5) +
  ggthemes::theme_map() 
```

&lt;img src="lecture-week-06_EDA-and-Modeling_ppol670_files/figure-html/unnamed-chunk-18-1.png" style="display: block; margin: auto;" /&gt;

---


```r
crimes %&gt;% 
  filter(location_category %in% c("street","residence")) %&gt;% 
   ggplot(aes(longitude,latitude,color = location_category)) +
  geom_point(alpha=.25) +
  ggthemes::theme_map() +
  facet_wrap(~location_category)
```

&lt;img src="lecture-week-06_EDA-and-Modeling_ppol670_files/figure-html/unnamed-chunk-19-1.png" style="display: block; margin: auto;" /&gt;

---


```r
crimes %&gt;% 
  group_by(month,offense_group) %&gt;% 
  count() %&gt;% 
  ggplot(aes(month,n,color=offense_group)) +
  geom_line() + geom_point() +
* gghighlight::gghighlight(max(n)&gt;40) +
  theme(legend.position="none")
```

&lt;img src="lecture-week-06_EDA-and-Modeling_ppol670_files/figure-html/unnamed-chunk-20-1.png" style="display: block; margin: auto;" /&gt;

---


```r
crimes %&gt;% 
  mutate(month_num = lubridate::month(date)) %&gt;% 
  group_by(month_num,offense_group) %&gt;% 
  count() %&gt;% 
  filter(max(n)&gt;=50) %&gt;% 
  ggplot(aes(factor(month_num),offense_group,fill=n)) +
  geom_tile() +
  scale_fill_viridis_c()
```

&lt;img src="lecture-week-06_EDA-and-Modeling_ppol670_files/figure-html/unnamed-chunk-21-1.png" style="display: block; margin: auto;" /&gt;

---


```r
crimes %&gt;% 
  mutate(month_num = lubridate::month(date)) %&gt;% 
  group_by(month_num,location_category) %&gt;% 
  count() %&gt;% 
  filter(max(n)&gt;=50) %&gt;% 
  ggplot(aes(factor(month_num),location_category,fill=n)) +
  geom_tile() +
  scale_fill_viridis_c()
```

&lt;img src="lecture-week-06_EDA-and-Modeling_ppol670_files/figure-html/unnamed-chunk-22-1.png" style="display: block; margin: auto;" /&gt;


---


```r
crimes %&gt;% 
  group_by(offense_group,location_category) %&gt;% 
  count() %&gt;% 
  filter(max(n) &gt; 100) %&gt;% 
  ggplot(aes(location_category,offense_group,fill=log(n))) +
  geom_tile() +
  scale_fill_viridis_c() 
```

&lt;img src="lecture-week-06_EDA-and-Modeling_ppol670_files/figure-html/unnamed-chunk-23-1.png" style="display: block; margin: auto;" /&gt;

---


```r
crimes %&gt;% 
  group_by(offense_group,offense_against) %&gt;% 
  count() %&gt;% 
  filter(max(n) &gt; 50) %&gt;%
  ggplot(aes(offense_against,offense_group,fill=log(n))) +
  geom_tile() +
  scale_fill_viridis_c() 
```

&lt;img src="lecture-week-06_EDA-and-Modeling_ppol670_files/figure-html/unnamed-chunk-24-1.png" style="display: block; margin: auto;" /&gt;

---

### Missingness


```r
crimes %&gt;% 
  summarize_all(function(x) sum(is.na(x))) %&gt;% 
  glimpse
```

```
## Observations: 1
## Variables: 14
## $ uid               &lt;int&gt; 0
## $ city_name         &lt;int&gt; 0
## $ offense_code      &lt;int&gt; 0
## $ offense_type      &lt;int&gt; 0
## $ offense_group     &lt;int&gt; 0
## $ offense_against   &lt;int&gt; 0
## $ date_single       &lt;int&gt; 0
## $ longitude         &lt;int&gt; 0
## $ latitude          &lt;int&gt; 0
## $ location_type     &lt;int&gt; 18
## $ location_category &lt;int&gt; 18
## $ census_block      &lt;int&gt; 0
## $ date              &lt;int&gt; 0
## $ month             &lt;int&gt; 0
```

---

### EDA... always to be continued

This was just an initial probe. There are many more ways we could try and slide the data to look at potential relationships that might offer some insights. 

--

The point is: 

- Exploration takes **time**

- There is no **roadmap** (else why would we need to explore?)

- EDA is the most **valuable** use of your time as a data scientist. 
  
  - Knowing your data requires that you to delve into it. 
  
  - Delving into it requires that you ask questions of the data.
  
  - Questions always lead to more (usually more interesting) questions

---

### EDA Checklist

- Where are the sources of variation?

- Which variables covary/correlate?

- What's the distribution across groupings (time, space, organization, etc.)?

- Are there outliers? Why? Where are they? 

- Is there missing data? If so, to what extent? For what variables? Is there something systematic about the missingness?

- Is there clustering in the data? (we'll delve more into this...)

- What does the data look like at different units of analysis (e.g. day, month, year)?

- etc.

---

class:newsection

# Modeling

---

### Linear Modeling 

The goal of a model is to provide a simple low-dimensional summary of a data set. 

&lt;br&gt;

Modeling is a form of **dimension reduction**: many data values are compressed into a single numerical statement.

&lt;br&gt;

Most all of you have completed the McCourt stats sequence, so we won't focus too much on statistical theory. Rather the aim will be to show how we can use modeling as exploratory tool. 


---

### Data 


```r
require(gapminder) # gapminder data 
gapminder %&gt;% 
  glimpse()
```

```
## Observations: 1,704
## Variables: 6
## $ country   &lt;fct&gt; Afghanistan, Afghanistan, Afghanistan, Afghanistan, Af…
## $ continent &lt;fct&gt; Asia, Asia, Asia, Asia, Asia, Asia, Asia, Asia, Asia, …
## $ year      &lt;int&gt; 1952, 1957, 1962, 1967, 1972, 1977, 1982, 1987, 1992, …
## $ lifeExp   &lt;dbl&gt; 28.801, 30.332, 31.997, 34.020, 36.088, 38.438, 39.854…
## $ pop       &lt;int&gt; 8425333, 9240934, 10267083, 11537966, 13079460, 148803…
## $ gdpPercap &lt;dbl&gt; 779.4453, 820.8530, 853.1007, 836.1971, 739.9811, 786.…
```

---

### Economic Development on Life expectancy


```r
gapminder %&gt;% 
  ggplot(aes(gdpPercap,lifeExp)) +
  geom_point() +
  geom_smooth(method="lm") +
  geom_smooth(method="loess",color="orange")
```

&lt;img src="lecture-week-06_EDA-and-Modeling_ppol670_files/figure-html/unnamed-chunk-27-1.png" style="display: block; margin: auto;" /&gt;

---

### Economic Development on Life expectancy


```r
gapminder %&gt;% 
  lm(lifeExp ~ gdpPercap,data=.) 
```

```
## 
## Call:
## lm(formula = lifeExp ~ gdpPercap, data = .)
## 
## Coefficients:
## (Intercept)    gdpPercap  
##   5.396e+01    7.649e-04
```


---

### Economic Development on Life expectancy


```r
gapminder &lt;- 
  gapminder %&gt;% 
  mutate(ln_gdpPercap = log(gdpPercap),
         ln_pop = log(pop)) 

gapminder %&gt;% 
  ggplot(aes(ln_gdpPercap,lifeExp)) +
  geom_point() +
  geom_smooth(method="lm")
```

&lt;img src="lecture-week-06_EDA-and-Modeling_ppol670_files/figure-html/unnamed-chunk-29-1.png" style="display: block; margin: auto;" /&gt;

---


```r
gapminder %&gt;% 
  lm(lifeExp ~ ln_gdpPercap,data=.) 
```

```
## 
## Call:
## lm(formula = lifeExp ~ ln_gdpPercap, data = .)
## 
## Coefficients:
##  (Intercept)  ln_gdpPercap  
##       -9.101         8.405
```

---



```r
gapminder %&gt;% 
  lm(lifeExp ~ ln_gdpPercap,data=.) %&gt;% 
* summary(.)
```

```
## 
## Call:
## lm(formula = lifeExp ~ ln_gdpPercap, data = .)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -32.778  -4.204   1.212   4.658  19.285 
## 
## Coefficients:
##              Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)   -9.1009     1.2277  -7.413 1.93e-13 ***
## ln_gdpPercap   8.4051     0.1488  56.500  &lt; 2e-16 ***
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## Residual standard error: 7.62 on 1702 degrees of freedom
## Multiple R-squared:  0.6522,	Adjusted R-squared:  0.652 
## F-statistic:  3192 on 1 and 1702 DF,  p-value: &lt; 2.2e-16
```

---



```r
gapminder %&gt;% 
  lm(lifeExp ~ ln_gdpPercap,data=.) %&gt;% 
* broom::tidy(.)
```

```
## # A tibble: 2 x 5
##   term         estimate std.error statistic  p.value
##   &lt;chr&gt;           &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;
## 1 (Intercept)     -9.10     1.23      -7.41 1.93e-13
## 2 ln_gdpPercap     8.41     0.149     56.5  0.
```

---


Do effects differ by **year**?


```r
gapminder %&gt;% 
  ggplot(aes(ln_gdpPercap,lifeExp,color=factor(year))) +
  geom_point() +
  geom_smooth(method="lm",se=F) +
  theme(legend.position = "none")
```

&lt;img src="lecture-week-06_EDA-and-Modeling_ppol670_files/figure-html/unnamed-chunk-33-1.png" style="display: block; margin: auto;" /&gt;

---

Do effects differ by **country**?


```r
gapminder %&gt;% 
  ggplot(aes(ln_gdpPercap,lifeExp,color=country)) +
  geom_point() +
  geom_smooth(method="lm",se=F) +
  theme(legend.position = "none")
```

&lt;img src="lecture-week-06_EDA-and-Modeling_ppol670_files/figure-html/unnamed-chunk-34-1.png" style="display: block; margin: auto;" /&gt;

---

### Many models

Do effects differ by **country**?


```r
my_model &lt;- function(df) coef(lm(lifeExp ~ ln_gdpPercap,data=df))[2]
gapminder %&gt;% 
  filter(country=="Nigeria") %&gt;% 
  my_model(.) 
```

```
## ln_gdpPercap 
##     13.05343
```

---

### Many models


```r
countries = unique(gapminder$country)
country_models &lt;- c()
for(c in countries){
  mod_results &lt;- 
    gapminder %&gt;% 
    filter(country==c) %&gt;% 
    my_model(.) %&gt;% 
    tibble(estimate=.) %&gt;% 
    mutate(country=c)
  country_models &lt;- bind_rows(country_models,mod_results)
}
head(country_models)
```

```
## # A tibble: 6 x 2
##   estimate country    
##      &lt;dbl&gt; &lt;chr&gt;      
## 1    -3.64 Afghanistan
## 2    15.6  Albania    
## 3    28.5  Algeria    
## 4    -4.58 Angola     
## 5    16.8  Argentina  
## 6    10.1  Australia
```

---

### Many models


```r
country_models %&gt;% 
  mutate(effect = ifelse(estimate&gt;=0,"positive","negative")) %&gt;% 
  ggplot(aes(x=estimate,fill=effect)) +
  geom_histogram(color="white",bins=75) +
  scale_fill_manual(values = c("darkred","dodgerblue3"))
```

&lt;img src="lecture-week-06_EDA-and-Modeling_ppol670_files/figure-html/unnamed-chunk-37-1.png" style="display: block; margin: auto;" /&gt;


---

`modelr` useful package for extracting model features (like residuals or predictions)


```r
*require(modelr)
mod &lt;- lm(lifeExp ~ ln_gdpPercap,data=gapminder)


gapminder %&gt;% 
* modelr::add_residuals(mod) %&gt;%  # Adds a column of residuals
  glimpse()
```

```
## Observations: 1,704
## Variables: 9
## $ country      &lt;fct&gt; Afghanistan, Afghanistan, Afghanistan, Afghanistan,…
## $ continent    &lt;fct&gt; Asia, Asia, Asia, Asia, Asia, Asia, Asia, Asia, Asi…
## $ year         &lt;int&gt; 1952, 1957, 1962, 1967, 1972, 1977, 1982, 1987, 199…
## $ lifeExp      &lt;dbl&gt; 28.801, 30.332, 31.997, 34.020, 36.088, 38.438, 39.…
## $ pop          &lt;int&gt; 8425333, 9240934, 10267083, 11537966, 13079460, 148…
## $ gdpPercap    &lt;dbl&gt; 779.4453, 820.8530, 853.1007, 836.1971, 739.9811, 7…
## $ ln_gdpPercap &lt;dbl&gt; 6.658583, 6.710344, 6.748878, 6.728864, 6.606625, 6…
## $ ln_pop       &lt;dbl&gt; 15.94675, 16.03915, 16.14445, 16.26115, 16.38655, 1…
## $ resid        &lt;dbl&gt; -18.064063, -16.968123, -15.627000, -13.435788, -10…
```

---

What does this tell us?


```r
gapminder %&gt;% 
  modelr::add_residuals(mod) %&gt;%  
  ggplot(aes(year,resid,group=country)) +
  geom_line(alpha=.5)
```

&lt;img src="lecture-week-06_EDA-and-Modeling_ppol670_files/figure-html/unnamed-chunk-39-1.png" style="display: block; margin: auto;" /&gt;



---


```r
gapminder %&gt;% 
  modelr::add_residuals(mod) %&gt;%  
  group_by(country) %&gt;% 
  ggplot(aes(year,resid,color=country)) +
  geom_line() + geom_point() +
  gghighlight::gghighlight(resid&lt;=-20 | resid &gt;= 15,
                           use_group_by = TRUE)
```

&lt;img src="lecture-week-06_EDA-and-Modeling_ppol670_files/figure-html/unnamed-chunk-40-1.png" style="display: block; margin: auto;" /&gt;

---

What does this tell us?


```r
gapminder %&gt;% 
  modelr::add_residuals(mod) %&gt;%  
  ggplot(aes(year,resid,group=country)) +
  geom_line(alpha=.5) +
  facet_wrap(~continent)
```

&lt;img src="lecture-week-06_EDA-and-Modeling_ppol670_files/figure-html/unnamed-chunk-41-1.png" style="display: block; margin: auto;" /&gt;

---

### Model objects


```r
mod &lt;- lm(lifeExp ~ ln_gdpPercap,data=gapminder)
names(mod)
```

```
##  [1] "coefficients"  "residuals"     "effects"       "rank"         
##  [5] "fitted.values" "assign"        "qr"            "df.residual"  
##  [9] "xlevels"       "call"          "terms"         "model"
```


```r
mod$coefficients
```

```
##  (Intercept) ln_gdpPercap 
##    -9.100889     8.405085
```


```r
mod$model # Data 
```

```
##       lifeExp ln_gdpPercap
## 1    28.80100     6.658583
## 2    30.33200     6.710344
## 3    31.99700     6.748878
## 4    34.02000     6.728864
## 5    36.08800     6.606625
## 6    38.43800     6.667101
## 7    39.85400     6.885521
## 8    40.82200     6.748051
## 9    41.67400     6.475959
## 10   41.76300     6.454162
## 11   42.12900     6.588561
## 12   43.82800     6.882007
## 13   55.23000     7.378419
## 14   59.28000     7.571620
## 15   64.82000     7.746253
## 16   66.22000     7.923057
## 17   67.69000     8.105737
## 18   68.93000     8.169904
## 19   70.42000     8.197231
## 20   72.00000     8.226555
## 21   71.58100     7.823021
## 22   72.95000     8.068733
## 23   75.65100     8.434727
## 24   76.42300     8.688964
## 25   43.07700     7.803438
## 26   45.68500     8.011015
## 27   48.30300     7.844169
## 28   51.40700     8.085484
## 29   54.51800     8.338704
## 30   58.01400     8.499114
## 31   61.36800     8.656113
## 32   65.79900     8.644946
## 33   67.74400     8.521826
## 34   69.15200     8.475808
## 35   70.99400     8.573203
## 36   72.30100     8.736066
## 37   30.01500     8.166390
## 38   31.99900     8.250082
## 39   34.00000     8.359200
## 40   35.98500     8.616636
## 41   37.92800     8.607635
## 42   39.48300     8.009246
## 43   39.94200     7.921882
## 44   39.90600     7.795732
## 45   40.64700     7.873920
## 46   40.96300     7.730676
## 47   41.00300     7.927789
## 48   42.73100     8.475794
## 49   62.48500     8.684624
## 50   64.39900     8.833004
## 51   65.14200     8.872510
## 52   65.63400     8.993794
## 53   67.06500     9.153033
## 54   68.48100     9.218212
## 55   69.94200     9.104746
## 56   70.77400     9.120380
## 57   71.86800     9.138675
## 58   73.27500     9.302672
## 59   74.34000     9.082239
## 60   75.32000     9.455588
## 61   69.12000     9.214292
## 62   70.33000     9.301063
## 63   70.93000     9.410602
## 64   71.10000     9.583704
## 65   71.93000     9.728457
## 66   73.49000     9.816523
## 67   74.74000     9.876990
## 68   76.32000     9.993734
## 69   77.56000    10.061549
## 70   78.83000    10.203516
## 71   80.37000    10.331619
## 72   81.23500    10.446839
## 73   66.80000     8.722104
## 74   67.48000     9.087336
## 75   69.54000     9.282728
## 76   70.14000     9.459900
## 77   70.63000     9.720863
## 78   72.17000     9.890880
## 79   73.18000     9.980314
## 80   74.94000    10.072717
## 81   76.04000    10.205147
## 82   77.51000    10.278353
## 83   78.98000    10.386457
## 84   79.82900    10.494782
## 85   50.93900     9.196960
## 86   53.83200     9.361842
## 87   56.92300     9.453543
## 88   59.92300     9.602698
## 89   63.30000     9.812942
## 90   65.59300     9.869936
## 91   69.05200     9.863246
## 92   70.75000     9.826824
## 93   72.60100     9.854065
## 94   73.92500     9.917983
## 95   74.79500    10.060643
## 96   75.63500    10.302131
## 97   37.48400     6.528315
## 98   39.34800     6.494718
## 99   41.21600     6.531375
## 100  43.45300     6.580897
## 101  45.25200     6.446091
## 102  46.92300     6.492054
## 103  50.00900     6.517644
## 104  52.81900     6.622709
## 105  56.01800     6.730792
## 106  59.41200     6.880148
## 107  62.01300     7.035612
## 108  64.06200     7.237961
## 109  68.00000     9.029191
## 110  69.24000     9.181422
## 111  70.25000     9.304851
## 112  70.94000     9.484104
## 113  71.44000     9.721495
## 114  72.80000     9.858384
## 115  73.93000     9.951318
## 116  75.35000    10.022406
## 117  76.46000    10.149393
## 118  77.53000    10.224164
## 119  78.32000    10.325019
## 120  79.44100    10.425034
## 121  38.22300     6.968617
## 122  40.35800     6.866518
## 123  42.61800     6.855935
## 124  44.88500     6.942960
## 125  47.01400     6.990069
## 126  49.19000     6.936499
## 127  50.90400     7.152972
## 128  52.33700     7.111395
## 129  53.91900     7.082723
## 130  54.77700     7.117185
## 131  54.40600     7.224664
## 132  56.72800     7.273290
## 133  40.41400     7.892574
## 134  41.89000     7.662790
## 135  43.42800     7.687526
## 136  45.03200     7.858210
## 137  46.71400     7.999790
## 138  50.02300     8.174167
## 139  53.85900     8.057222
## 140  57.25100     7.920698
## 141  59.95700     7.993519
## 142  62.05000     8.109569
## 143  63.88300     8.135424
## 144  65.55400     8.248565
## 145  53.82000     6.880932
## 146  58.45000     7.210810
## 147  61.93000     7.444064
## 148  64.79000     7.683566
## 149  67.45000     7.958636
## 150  69.86000     8.168623
## 151  70.69000     8.325212
## 152  71.14000     8.369647
## 153  72.17800     7.842586
## 154  73.24400     8.469337
## 155  74.09000     8.702672
## 156  74.85200     8.915472
## 157  47.62200     6.746695
## 158  49.61800     6.822451
## 159  51.52000     6.891274
## 160  53.29800     7.102260
## 161  56.02400     7.724717
## 162  59.31900     8.075538
## 163  61.48400     8.423134
## 164  63.62200     8.733253
## 165  62.74500     8.981444
## 166  52.55600     9.064984
## 167  46.63400     9.305978
## 168  50.72800     9.439057
## 169  50.91700     7.653943
## 170  53.28500     7.818980
## 171  55.66500     8.112703
## 172  57.63200     8.140276
## 173  59.50400     8.514331
## 174  61.48900     8.803893
## 175  63.33600     8.858061
## 176  65.20500     8.962788
## 177  67.05700     8.846538
## 178  69.38800     8.981931
## 179  71.00600     9.003465
## 180  72.39000     9.112264
## 181  59.60000     7.801509
## 182  66.61000     8.009254
## 183  69.51000     8.355694
## 184  70.42000     8.626407
## 185  70.90000     8.794445
## 186  70.81000     8.937513
## 187  71.08000     9.014835
## 188  71.34000     9.016738
## 189  71.19000     8.748721
## 190  70.32000     8.694567
## 191  72.14000     8.948557
## 192  73.00500     9.276202
## 193  31.97500     6.297579
## 194  34.90600     6.425166
## 195  37.81400     6.582734
## 196  40.69700     6.678124
## 197  43.59100     6.750793
## 198  46.13700     6.611217
## 199  48.12200     6.693570
## 200  49.55700     6.815709
## 201  50.26000     6.837068
## 202  50.32400     6.852554
## 203  50.65000     6.944709
## 204  52.29500     7.104171
## 205  39.03100     5.826874
## 206  40.53300     5.939025
## 207  42.04500     5.872690
## 208  43.54800     6.023393
## 209  44.05700     6.140099
## 210  45.91000     6.320954
## 211  47.47100     6.327228
## 212  48.21100     6.432649
## 213  44.73600     6.448414
## 214  45.32600     6.137976
## 215  47.36000     6.101223
## 216  49.58000     6.063950
## 217  39.41700     5.909357
## 218  41.36600     6.073133
## 219  43.41500     6.208416
## 220  45.41500     6.260408
## 221  40.31700     6.044114
## 222  31.22000     6.263345
## 223  50.95700     6.436912
## 224  53.91400     6.527805
## 225  55.80300     6.525474
## 226  56.53400     6.598897
## 227  56.75200     6.798193
## 228  59.72300     7.446456
## 229  38.52300     7.067036
## 230  40.42800     7.180107
## 231  42.64300     7.243947
## 232  44.79900     7.318840
## 233  47.04900     7.429014
## 234  49.35500     7.486295
## 235  52.96100     7.769794
## 236  54.98500     7.864291
## 237  54.31400     7.491737
## 238  52.19900     7.435047
## 239  49.85600     7.567352
## 240  50.43000     7.621732
## 241  68.75000     9.338484
## 242  69.96000     9.432680
## 243  71.30000     9.507662
## 244  72.13000     9.685119
## 245  72.88000     9.850644
## 246  74.21000    10.002920
## 247  75.76000    10.038839
## 248  76.86000    10.189663
## 249  77.95000    10.178953
## 250  78.61000    10.273496
## 251  79.77000    10.414182
## 252  80.65300    10.500103
## 253  35.46300     6.976638
## 254  37.46400     7.082418
## 255  39.47500     7.084284
## 256  41.47800     7.035318
## 257  43.45700     6.975426
## 258  46.77500     7.011551
## 259  48.29500     6.863545
## 260  50.48500     6.739190
## 261  49.39600     6.617277
## 262  46.06600     6.607334
## 263  43.30800     6.604879
## 264  44.74100     6.559639
## 265  38.09200     7.072139
## 266  39.88100     7.176633
## 267  41.71600     7.236928
## 268  43.60100     7.087415
## 269  45.56900     7.006789
## 270  47.38300     7.033493
## 271  49.51700     6.681993
## 272  51.05100     6.858971
## 273  51.72400     6.964196
## 274  51.57300     6.912704
## 275  50.52500     7.052878
## 276  50.65100     7.440771
## 277  54.74500     8.278931
## 278  56.07400     8.369997
## 279  57.92400     8.416067
## 280  60.52300     8.538300
## 281  63.44100     8.611416
## 282  67.05200     8.467323
## 283  70.56500     8.536146
## 284  72.49200     8.621024
## 285  74.12600     8.935394
## 286  75.81600     9.222077
## 287  77.86000     9.285335
## 288  78.55300     9.485821
## 289  44.00000     5.992585
## 290  50.54896     6.356085
## 291  44.50136     6.189647
## 292  58.38112     6.417885
## 293  63.11888     6.517524
## 294  63.96736     6.608321
## 295  65.52500     6.869452
## 296  67.27400     7.229044
## 297  68.69000     7.412030
## 298  70.42600     7.735973
## 299  72.02800     8.045358
## 300  72.96100     8.508983
## 301  50.64300     7.670482
## 302  55.11800     7.750961
## 303  57.86300     7.820982
## 304  59.96300     7.893098
## 305  61.62300     8.090911
## 306  63.83700     8.246908
## 307  66.65300     8.388809
## 308  67.76800     8.497647
## 309  68.42100     8.602389
## 310  70.31300     8.718886
## 311  71.68200     8.657869
## 312  72.88900     8.854605
## 313  40.71500     7.005781
## 314  42.46000     7.099324
## 315  44.46700     7.248965
## 316  46.47200     7.536913
## 317  48.94400     7.569194
## 318  50.93900     7.066981
## 319  52.93300     7.144486
## 320  54.92600     7.182338
## 321  57.93900     7.128422
## 322  60.66000     7.067847
## 323  62.97400     6.980831
## 324  65.15200     6.893806
## 325  39.14300     6.659989
## 326  40.65200     6.808885
## 327  42.12200     6.798292
## 328  44.05600     6.758783
## 329  45.98900     6.807820
## 330  47.80400     6.679294
## 331  47.78400     6.512856
## 332  47.41200     6.511411
## 333  45.54800     6.126256
## 334  42.58700     5.743607
## 335  44.96600     5.485485
## 336  46.46200     5.626008
## 337  42.11100     7.661819
## 338  45.05300     7.747189
## 339  48.43500     7.809859
## 340  52.04000     7.892803
## 341  54.90700     8.075008
## 342  55.62500     8.089231
## 343  56.69500     8.492800
## 344  57.47000     8.343124
## 345  56.43300     8.298101
## 346  52.96200     8.155984
## 347  52.97000     8.155954
## 348  55.32200     8.197692
## 349  57.20600     7.873601
## 350  60.02600     8.003032
## 351  62.84200     8.149295
## 352  65.42400     8.333686
## 353  67.84900     8.540548
## 354  70.75000     8.687253
## 355  73.45000     8.568406
## 356  74.75200     8.635850
## 357  75.71300     8.725900
## 358  77.26000     8.806431
## 359  78.12300     8.952016
## 360  78.78200     9.174201
## 361  40.47700     7.236048
## 362  42.46900     7.313817
## 363  44.93000     7.455223
## 364  47.35000     7.626595
## 365  49.80100     7.774100
## 366  52.37400     7.831116
## 367  53.98300     7.864309
## 368  54.65500     7.676453
## 369  52.04400     7.407362
## 370  47.99100     7.487882
## 371  46.83200     7.407804
## 372  48.32800     7.342617
## 373  61.21000     8.045344
## 374  64.77000     8.375222
## 375  67.13000     8.608475
## 376  68.50000     8.847978
## 377  69.61000     9.123048
## 378  70.64000     9.333034
## 379  70.46000     9.489624
## 380  71.52000     9.534059
## 381  72.52700     9.041661
## 382  73.68000     9.197823
## 383  74.87600     9.361205
## 384  75.74800     9.590093
## 385  59.42100     8.628115
## 386  62.32500     8.714760
## 387  65.24600     8.552706
## 388  68.29000     8.646513
## 389  70.72300     8.576489
## 390  72.64900     8.761001
## 391  73.71700     8.897944
## 392  74.17400     8.927039
## 393  74.41400     8.629243
## 394  76.15100     8.600061
## 395  77.15800     8.754736
## 396  78.27300     9.099197
## 397  66.87000     8.835813
## 398  69.03000     9.018737
## 399  69.90000     9.223934
## 400  70.38000     9.341320
## 401  70.29000     9.481013
## 402  70.71000     9.602393
## 403  70.96000     9.640643
## 404  71.58000     9.699561
## 405  72.40000     9.567806
## 406  74.01000     9.683372
## 407  75.51000     9.775439
## 408  76.48600    10.035976
## 409  70.78000     9.179096
## 410  71.81000     9.314670
## 411  72.35000     9.516597
## 412  72.96000     9.676412
## 413  73.47000     9.845128
## 414  74.69000     9.924412
## 415  74.63000     9.984516
## 416  74.80000    10.131267
## 417  75.33000    10.181375
## 418  76.11000    10.302409
## 419  77.18000    10.378681
## 420  78.33200    10.471027
## 421  34.81200     7.889658
## 422  37.32800     7.960313
## 423  39.69300     8.013340
## 424  42.07400     8.013029
## 425  44.36600     8.214523
## 426  46.51900     8.033256
## 427  48.81200     7.965361
## 428  50.04000     7.965581
## 429  51.60400     7.773660
## 430  53.15700     7.546983
## 431  53.37300     7.553948
## 432  54.79100     7.641316
## 433  45.92800     7.242596
## 434  49.82800     7.342393
## 435  53.45900     7.415860
## 436  56.75100     7.410784
## 437  59.63100     7.691600
## 438  61.78800     7.894314
## 439  63.72700     7.958959
## 440  66.04600     7.972412
## 441  68.45700     8.020998
## 442  69.95700     8.192598
## 443  70.84700     8.425913
## 444  72.23500     8.703735
## 445  48.35700     8.166816
## 446  51.35600     8.237624
## 447  54.64000     8.315350
## 448  56.67800     8.429252
## 449  58.79600     8.571870
## 450  61.31000     8.806817
## 451  64.34200     8.883750
## 452  67.23100     8.776750
## 453  69.61300     8.868371
## 454  72.31200     8.913208
## 455  74.17300     8.660955
## 456  74.99400     8.835394
## 457  41.89300     7.257583
## 458  44.44400     7.285448
## 459  46.99200     7.434456
## 460  49.29300     7.503775
## 461  51.13700     7.612835
## 462  53.31900     7.932180
## 463  56.00600     8.161583
## 464  59.79700     8.264997
## 465  63.67400     8.241375
## 466  67.21700     8.336434
## 467  69.80600     8.466869
## 468  71.33800     8.627156
## 469  45.26200     8.022340
## 470  48.57000     8.137841
## 471  52.30700     8.236633
## 472  55.85500     8.379905
## 473  58.20700     8.416322
## 474  56.69600     8.544599
## 475  56.60400     8.318338
## 476  63.15400     8.328558
## 477  66.79800     8.399362
## 478  69.53500     8.547689
## 479  70.73400     8.585145
## 480  71.87800     8.653183
## 481  34.48200     5.928640
## 482  35.98300     6.054666
## 483  37.48500     6.367916
## 484  38.98700     6.819575
## 485  40.51600     6.510872
## 486  42.02400     6.865439
## 487  43.66200     6.832844
## 488  45.66400     6.874092
## 489  47.54500     7.031790
## 490  48.24500     7.942533
## 491  49.34800     8.949430
## 492  51.57900     9.405421
## 493  35.92800     5.795877
## 494  38.04700     5.841112
## 495  40.15800     5.942788
## 496  42.18900     6.150166
## 497  44.14200     6.242854
## 498  44.53500     6.226050
## 499  43.89000     6.263162
## 500  46.45300     6.256007
## 501  49.99100     6.367944
## 502  53.37800     6.817251
## 503  55.24000     6.640333
## 504  58.04000     6.463606
## 505  34.07800     5.892048
## 506  36.66700     5.937283
## 507  40.05900     6.038960
## 508  42.11500     6.246337
## 509  43.51500     6.339025
## 510  44.51000     6.322221
## 511  44.91600     6.359333
## 512  46.68400     6.352179
## 513  48.09100     6.043472
## 514  49.40200     6.245892
## 515  50.72500     6.272978
## 516  52.94700     6.537858
## 517  66.55000     8.767877
## 518  67.49000     8.928695
## 519  68.75000     9.145465
## 520  69.83000     9.298501
## 521  70.87000     9.572124
## 522  72.52000     9.655374
## 523  74.55000     9.827317
## 524  74.83000     9.958970
## 525  75.70000     9.935333
## 526  77.13000    10.074240
## 527  78.37000    10.247240
## 528  79.31300    10.410519
## 529  67.41000     8.857915
## 530  68.93000     9.066797
## 531  70.51000     9.264875
## 532  71.55000     9.472698
## 533  72.38000     9.687021
## 534  73.83000     9.814254
## 535  74.89000     9.918076
## 536  76.34000    10.001813
## 537  77.46000    10.114712
## 538  78.64000    10.161604
## 539  79.59000    10.272497
## 540  80.65700    10.324498
## 541  37.00300     8.364852
## 542  38.99900     8.512421
## 543  40.48900     8.799580
## 544  44.59800     9.031066
## 545  48.69000     9.341540
## 546  52.79000     9.987165
## 547  56.56400     9.623335
## 548  60.19000     9.381298
## 549  61.36600     9.512085
## 550  60.46100     9.597155
## 551  56.76100     9.435220
## 552  56.73500     9.488463
## 553  30.00000     6.184624
## 554  32.06500     6.255609
## 555  33.89600     6.396347
## 556  35.85700     6.599575
## 557  38.30800     6.628156
## 558  41.84200     6.785311
## 559  45.58000     6.728401
## 560  49.26500     6.416175
## 561  52.64400     6.500726
## 562  55.86100     6.482695
## 563  58.04100     6.493127
## 564  59.44800     6.623733
## 565  67.50000     8.874044
## 566  69.10000     9.228949
## 567  70.30000     9.465173
## 568  70.80000     9.598702
## 569  71.00000     9.799026
## 570  72.50000     9.928810
## 571  73.80000    10.000230
## 572  74.84700    10.112093
## 573  76.07000    10.185100
## 574  77.34000    10.232391
## 575  78.67000    10.310145
## 576  79.40600    10.378801
## 577  43.14900     6.814871
## 578  44.77900     6.950395
## 579  46.45200     7.081743
## 580  48.07200     7.026158
## 581  49.87500     7.071763
## 582  51.75600     6.900956
## 583  53.74400     6.775403
## 584  55.72900     6.741708
## 585  57.50100     6.829859
## 586  58.55600     6.912987
## 587  58.45300     7.013902
## 588  60.02200     7.191135
## 589  65.86000     8.169249
## 590  67.86000     8.500311
## 591  69.51000     8.702376
## 592  71.00000     9.049361
## 593  72.34000     9.451310
## 594  73.68000     9.560682
## 595  75.24000     9.633542
## 596  76.67000     9.687849
## 597  77.03000     9.772325
## 598  77.86900     9.838826
## 599  78.25600    10.021904
## 600  79.48300    10.223337
## 601  42.02300     7.794921
## 602  44.14200     7.869843
## 603  46.95400     7.919489
## 604  50.01600     8.084110
## 605  53.73800     8.301871
## 606  56.02900     8.492899
## 607  58.13700     8.480632
## 608  60.78200     8.353847
## 609  63.37300     8.398286
## 610  66.32200     8.451975
## 611  68.97800     8.488454
## 612  70.25900     8.553728
## 613  33.60900     6.234796
## 614  34.55800     6.356571
## 615  35.75300     6.531422
## 616  37.19700     6.563516
## 617  38.84200     6.608899
## 618  40.76200     6.773865
## 619  42.89100     6.753730
## 620  45.55200     6.691553
## 621  48.57600     6.677522
## 622  51.45500     6.767861
## 623  53.67600     6.851802
## 624  56.00700     6.848700
## 625  32.50000     5.703283
## 626  33.48900     6.067940
## 627  34.48800     6.257733
## 628  35.49200     6.573094
## 629  36.48600     6.709578
## 630  37.46500     6.639518
## 631  39.32700     6.731166
## 632  41.24500     6.601794
## 633  43.26600     6.614109
## 634  44.87300     6.680434
## 635  45.50400     6.355595
## 636  46.38800     6.361703
## 637  37.57900     7.517720
## 638  40.69600     7.454076
## 639  43.59000     7.493645
## 640  46.24300     7.280737
## 641  48.04200     7.411228
## 642  49.92300     7.535990
## 643  51.46100     7.606467
## 644  53.63600     7.508248
## 645  55.08900     7.283661
## 646  56.67100     7.201713
## 647  58.13700     7.147059
## 648  60.91600     7.091440
## 649  41.91200     7.693904
## 650  44.66500     7.705482
## 651  48.04100     7.736812
## 652  50.92400     7.839238
## 653  53.88400     7.835912
## 654  57.40200     8.071908
## 655  60.90900     8.046152
## 656  64.49200     8.014037
## 657  66.39900     8.033235
## 658  67.65900     8.058471
## 659  68.56500     8.039070
## 660  70.19800     8.174233
## 661  60.96000     8.024345
## 662  64.75000     8.196733
## 663  67.65000     8.453752
## 664  70.00000     8.731976
## 665  72.00000     9.025928
## 666  73.60000     9.322431
## 667  75.45000     9.586070
## 668  76.20000     9.905409
## 669  77.60100    10.116888
## 670  80.00000    10.253357
## 671  81.49500    10.315896
## 672  82.20800    10.589735
## 673  64.03000     8.568585
## 674  66.41000     8.706189
## 675  67.96000     8.929351
## 676  69.50000     9.140631
## 677  69.76000     9.227065
## 678  69.95000     9.365191
## 679  69.39000     9.437156
## 680  69.58000     9.471664
## 681  69.17000     9.262518
## 682  71.04000     9.368436
## 683  72.59000     9.605347
## 684  73.33800     9.798624
## 685  72.49000     8.891194
## 686  73.47000     9.131730
## 687  73.68000     9.244757
## 688  73.73000     9.497014
## 689  74.46000     9.667643
## 690  76.11000     9.886085
## 691  76.99000    10.054903
## 692  77.23000    10.200744
## 693  78.77000    10.132390
## 694  78.95000    10.242140
## 695  80.50000    10.346993
## 696  81.75700    10.496284
## 697  37.37300     6.303655
## 698  40.24900     6.380228
## 699  43.60500     6.489732
## 700  47.19300     6.552181
## 701  50.65100     6.584836
## 702  54.20800     6.701146
## 703  56.59600     6.751947
## 704  58.55300     6.883988
## 705  60.22300     7.059967
## 706  61.76500     7.285381
## 707  62.87900     7.465523
## 708  64.69800     7.804745
## 709  37.46800     6.619649
## 710  39.91800     6.755653
## 711  42.51800     6.744400
## 712  45.96400     6.636513
## 713  49.20300     7.013113
## 714  52.70200     7.231795
## 715  56.15900     7.324406
## 716  60.13700     7.466432
## 717  62.68100     7.776175
## 718  66.04100     8.045375
## 719  68.58800     7.963430
## 720  70.65000     8.172066
## 721  44.86900     8.018074
## 722  47.18100     8.098721
## 723  49.32500     8.339819
## 724  52.46900     8.683848
## 725  55.23400     9.170957
## 726  57.70200     9.383335
## 727  59.62000     8.937000
## 728  63.04000     8.801301
## 729  65.74200     8.886776
## 730  68.04200     9.019614
## 731  69.45100     9.131380
## 732  70.96400     9.359253
## 733  45.32000     8.325976
## 734  48.43700     8.737025
## 735  51.45700     9.029027
## 736  54.45900     9.097335
## 737  56.95000     9.167019
## 738  60.41300     9.594802
## 739  62.03800     9.583138
## 740  65.04400     9.362510
## 741  59.46100     8.228348
## 742  58.81100     8.031463
## 743  57.04600     8.387248
## 744  59.54500     8.405381
## 745  66.91000     8.558389
## 746  68.90000     8.630357
## 747  70.29000     8.799601
## 748  71.08000     8.943189
## 749  71.28000     9.162281
## 750  72.03000     9.319283
## 751  73.10000     9.442905
## 752  74.36000     9.537690
## 753  75.46700     9.773311
## 754  76.12200    10.107324
## 755  77.78300    10.436379
## 756  78.88500    10.613393
## 757  65.39000     8.315450
## 758  67.84000     8.591424
## 759  69.39000     8.868643
## 760  70.75000     9.035242
## 761  71.63000     9.456179
## 762  73.06000     9.496017
## 763  74.45000     9.639980
## 764  75.60000     9.748147
## 765  76.93000     9.800985
## 766  78.26900     9.947342
## 767  79.69600     9.994497
## 768  80.74500    10.147346
## 769  65.94000     8.503379
## 770  67.81000     8.740122
## 771  69.24000     9.017190
## 772  71.06000     9.212578
## 773  72.19000     9.414853
## 774  73.48000     9.564932
## 775  74.98000     9.713385
## 776  76.42000     9.863042
## 777  77.44000     9.999418
## 778  78.82000    10.113547
## 779  80.24000    10.238820
## 780  80.54600    10.260103
## 781  58.53000     7.971959
## 782  62.61000     8.467273
## 783  65.61000     8.565242
## 784  67.51000     8.720086
## 785  69.00000     8.913804
## 786  70.11000     8.802402
## 787  71.21000     8.710793
## 788  71.77000     8.756405
## 789  71.76600     8.909900
## 790  72.26200     8.870933
## 791  72.04700     8.852919
## 792  72.56700     8.898486
## 793  63.03000     8.076191
## 794  65.50000     8.370477
## 795  68.73000     8.791281
## 796  71.43000     9.195002
## 797  73.42000     9.600948
## 798  75.38000     9.717783
## 799  77.11000     9.872209
## 800  78.67000    10.015742
## 801  79.36000    10.197086
## 802  80.69000    10.268706
## 803  82.00000    10.261323
## 804  82.60300    10.362685
## 805  43.15800     7.344013
## 806  45.66900     7.542256
## 807  48.12600     7.761323
## 808  51.62900     7.916369
## 809  56.52800     7.654849
## 810  61.13400     7.955899
## 811  63.73900     8.333611
## 812  65.86900     8.400363
## 813  68.01500     8.140780
## 814  69.77200     8.201216
## 815  71.26300     8.254507
## 816  72.53500     8.416148
## 817  42.27000     6.749393
## 818  44.68600     6.850590
## 819  47.94900     6.799018
## 820  50.65400     6.962941
## 821  53.55900     7.108539
## 822  56.15500     7.144891
## 823  58.76600     7.206545
## 824  59.33900     7.216663
## 825  59.28500     7.201858
## 826  54.40700     7.215597
## 827  50.99200     7.160469
## 828  54.11000     7.288415
## 829  50.05600     6.992352
## 830  54.08100     7.359553
## 831  56.65600     7.391226
## 832  59.94200     7.670214
## 833  63.98300     8.216526
## 834  67.15900     8.320278
## 835  69.10000     8.320333
## 836  70.64700     8.320324
## 837  69.97800     8.223108
## 838  67.72700     7.432932
## 839  66.66200     7.406564
## 840  67.29700     7.373415
## 841  47.45300     6.937889
## 842  52.68100     7.304915
## 843  55.29200     7.337161
## 844  57.71600     7.615411
## 845  62.61200     8.016607
## 846  64.76600     8.446174
## 847  67.12300     8.634610
## 848  69.81000     9.051707
## 849  72.24400     9.401314
## 850  74.64700     9.679939
## 851  77.04500     9.864434
## 852  78.62300    10.058273
## 853  55.56500    11.593421
## 854  58.03300    11.639762
## 855  60.47000    11.466443
## 856  64.62400    11.300906
## 857  67.71200    11.602290
## 858  69.34300    10.989782
## 859  71.30900    10.353098
## 860  74.17400    10.244181
## 861  75.19000    10.461185
## 862  76.15600    10.604122
## 863  76.90400    10.466244
## 864  77.58800    10.764413
## 865  55.92800     8.483596
## 866  59.48900     8.714368
## 867  62.09400     8.650773
## 868  63.87000     8.700678
## 869  65.42100     8.920841
## 870  66.09900     9.066435
## 871  66.98300     8.941221
## 872  67.92600     8.589903
## 873  69.29200     8.837943
## 874  70.26500     9.077376
## 875  71.02800     9.139267
## 876  71.99300     9.255415
## 877  42.13800     5.699929
## 878  45.04700     5.817103
## 879  47.74700     6.020539
## 880  48.49200     6.211882
## 881  49.76700     6.207748
## 882  52.20800     6.613880
## 883  55.07800     6.681185
## 884  57.18000     6.651563
## 885  59.68500     6.884984
## 886  55.55800     7.078466
## 887  44.59300     7.150846
## 888  42.59200     7.358405
## 889  38.48000     6.355366
## 890  39.48600     6.431283
## 891  40.50200     6.452357
## 892  41.53600     6.570328
## 893  42.61400     6.688362
## 894  43.76400     6.461972
## 895  44.85200     6.349488
## 896  46.02700     6.226762
## 897  40.80200     6.456178
## 898  42.22100     6.412104
## 899  43.75300     6.275670
## 900  45.67800     6.027091
## 901  42.72300     7.778022
## 902  45.28900     8.145632
## 903  47.80800     8.818339
## 904  50.22700     9.840162
## 905  52.77300     9.952825
## 906  57.44200     9.996578
## 907  62.15500     9.762170
## 908  66.23400     9.373359
## 909  68.75500     9.173691
## 910  71.55500     9.155614
## 911  72.73700     9.162691
## 912  73.95200     9.397442
## 913  36.68100     7.274488
## 914  38.86500     7.370988
## 915  40.84800     7.404515
## 916  42.88100     7.398815
## 917  44.85100     7.466550
## 918  46.88100     7.342280
## 919  48.96900     7.172331
## 920  49.35000     7.052238
## 921  52.21400     6.947626
## 922  54.97800     6.893956
## 923  57.28600     6.796418
## 924  59.44300     6.951552
## 925  36.25600     5.911244
## 926  37.20700     6.031574
## 927  38.41000     6.058892
## 928  39.48700     6.205597
## 929  41.76600     6.370965
## 930  43.76700     6.497112
## 931  45.64200     6.450161
## 932  47.45700     6.454439
## 933  49.42000     6.333635
## 934  47.49500     6.539984
## 935  45.00900     6.500423
## 936  48.30300     6.632463
## 937  48.46300     7.512690
## 938  52.10200     7.501119
## 939  55.73700     7.619177
## 940  59.37100     7.730940
## 941  63.01000     7.954757
## 942  65.25600     8.250077
## 943  68.00000     8.501136
## 944  69.50000     8.565946
## 945  70.69300     8.892599
## 946  71.93800     9.223544
## 947  73.04400     9.230827
## 948  74.24100     9.429609
## 949  33.68500     6.114427
## 950  35.30700     6.195185
## 951  36.93600     6.206927
## 952  38.48700     6.300804
## 953  39.97700     6.365385
## 954  41.71400     6.531454
## 955  43.91600     6.426511
## 956  46.36400     6.528209
## 957  48.38800     6.605317
## 958  49.90300     6.672359
## 959  51.81800     6.857945
## 960  54.46700     6.949455
## 961  40.54300     6.610852
## 962  42.33800     6.740662
## 963  44.24800     6.962145
## 964  46.28900     7.259218
## 965  48.43700     7.369507
## 966  50.85200     7.311547
## 967  53.59900     7.300574
## 968  56.14500     7.259541
## 969  58.33300     7.216247
## 970  60.43000     7.301914
## 971  62.24700     7.364559
## 972  64.16400     7.497291
## 973  50.98600     7.584751
## 974  58.08900     7.617778
## 975  60.24600     7.835606
## 976  61.55700     7.814152
## 977  62.94400     7.853793
## 978  64.93000     8.219052
## 979  66.71100     8.212850
## 980  68.74000     8.472946
## 981  69.74500     8.709177
## 982  70.73600     8.912703
## 983  71.95400     9.107401
## 984  72.80100     9.301733
## 985  50.78900     8.154249
## 986  55.19000     8.326407
## 987  58.29900     8.429806
## 988  60.11000     8.657778
## 989  62.36100     8.826060
## 990  65.03200     8.945714
## 991  67.40500     9.170679
## 992  69.49800     9.069716
## 993  71.45500     9.156136
## 994  73.67000     9.186795
## 995  74.90200     9.281958
## 996  76.19500     9.390791
## 997  42.24400     6.667678
## 998  45.24800     6.816366
## 999  48.25100     6.962579
## 1000 51.25300     7.111546
## 1001 53.75400     7.259638
## 1002 55.49100     7.407021
## 1003 57.48900     7.601204
## 1004 60.22200     7.757055
## 1005 61.27100     7.487399
## 1006 63.62500     7.550794
## 1007 65.03300     7.668907
## 1008 66.80300     8.037793
## 1009 59.16400     7.881403
## 1010 61.44800     8.211282
## 1011 63.72800     8.444535
## 1012 67.17800     8.684037
## 1013 70.63600     8.959108
## 1014 73.06600     9.169094
## 1015 74.10100     9.325684
## 1016 74.86500     9.370119
## 1017 75.43500     8.854142
## 1018 75.44500     8.774253
## 1019 73.98100     8.788318
## 1020 74.54300     9.132800
## 1021 42.87300     7.431420
## 1022 45.42300     7.403672
## 1023 47.92400     7.356506
## 1024 50.33500     7.444859
## 1025 52.86200     7.565376
## 1026 55.73000     7.770907
## 1027 59.65000     7.901977
## 1028 62.67700     7.921190
## 1029 65.39300     7.988898
## 1030 67.66000     8.000384
## 1031 69.61500     8.089021
## 1032 71.16400     8.248052
## 1033 31.28600     6.149592
## 1034 33.77900     6.205743
## 1035 36.16100     6.322002
## 1036 38.11300     6.339776
## 1037 40.32800     6.586058
## 1038 42.49500     6.219237
## 1039 42.79500     6.136022
## 1040 42.86100     5.965829
## 1041 44.28400     6.018342
## 1042 46.34400     6.157712
## 1043 44.02600     6.451446
## 1044 42.08200     6.713789
## 1045 36.31900     5.802118
## 1046 41.90500     5.857933
## 1047 45.10800     5.961005
## 1048 49.37900     5.855072
## 1049 53.07000     5.877736
## 1050 56.05900     5.916202
## 1051 58.05600     6.049733
## 1052 58.33900     5.953243
## 1053 59.32000     5.849325
## 1054 60.32800     6.028279
## 1055 59.90800     6.415097
## 1056 62.06900     6.850126
## 1057 41.72500     7.793084
## 1058 45.22600     7.871482
## 1059 48.38600     8.062501
## 1060 51.15900     8.241096
## 1061 53.86700     8.228465
## 1062 56.43700     8.262684
## 1063 58.96800     8.340719
## 1064 60.83500     8.214392
## 1065 61.99900     8.243950
## 1066 58.90900     8.268610
## 1067 51.47900     8.311969
## 1068 52.90600     8.478673
## 1069 36.15700     6.302373
## 1070 37.68600     6.393484
## 1071 39.39300     6.480653
## 1072 41.47200     6.516847
## 1073 43.97100     6.514399
## 1074 46.74800     6.542634
## 1075 49.59400     6.576989
## 1076 52.53700     6.653679
## 1077 55.72700     6.799881
## 1078 59.42600     6.918589
## 1079 61.34000     6.963385
## 1080 63.78500     6.995180
## 1081 72.13000     9.098467
## 1082 72.99000     9.330449
## 1083 73.23000     9.456485
## 1084 73.82000     9.639734
## 1085 73.75000     9.841333
## 1086 75.24000     9.962184
## 1087 76.05000     9.971121
## 1088 76.83000    10.071174
## 1089 77.42000    10.195819
## 1090 78.03000    10.317124
## 1091 78.53000    10.425987
## 1092 79.76200    10.513197
## 1093 69.39000     9.264504
## 1094 70.26000     9.413069
## 1095 71.24000     9.486128
## 1096 71.52000     9.579412
## 1097 71.89000     9.683217
## 1098 72.22000     9.694846
## 1099 73.84000     9.777494
## 1100 74.32000     9.852573
## 1101 76.33000     9.818111
## 1102 77.55000     9.954675
## 1103 79.11000    10.051468
## 1104 80.20400    10.134004
## 1105 42.31400     8.043138
## 1106 45.43200     8.148277
## 1107 48.63200     8.198190
## 1108 51.88400     8.443201
## 1109 55.15100     8.452888
## 1110 57.47000     8.610022
## 1111 59.29800     8.152007
## 1112 62.00800     7.991587
## 1113 65.84300     7.682552
## 1114 68.42600     7.720028
## 1115 70.83600     7.813813
## 1116 72.89900     7.919109
## 1117 37.44400     6.635788
## 1118 38.59800     6.728058
## 1119 39.48700     6.905519
## 1120 40.11800     6.960713
## 1121 40.54600     6.860883
## 1122 41.29100     6.695672
## 1123 42.59800     6.813139
## 1124 44.55500     6.504737
## 1125 47.39100     6.365065
## 1126 51.31300     6.363554
## 1127 54.49600     6.398719
## 1128 56.86700     6.429198
## 1129 36.32400     6.982196
## 1130 37.80200     7.003604
## 1131 39.36000     7.048323
## 1132 41.04000     6.922165
## 1133 42.82100     7.437435
## 1134 44.51400     7.591837
## 1135 45.82600     7.363263
## 1136 46.88600     7.233477
## 1137 47.47200     7.390088
## 1138 47.46400     7.393227
## 1139 46.60800     7.387268
## 1140 46.85900     7.607867
## 1141 72.67000     9.219837
## 1142 73.44000     9.363402
## 1143 73.47000     9.506764
## 1144 74.08000     9.702709
## 1145 74.34000     9.850353
## 1146 75.37000    10.056696
## 1147 75.97000    10.177272
## 1148 75.89000    10.359043
## 1149 77.32000    10.433105
## 1150 78.32000    10.628210
## 1151 79.05000    10.707370
## 1152 80.19600    10.806839
## 1153 37.57800     7.511104
## 1154 40.08000     7.715457
## 1155 43.16500     7.980926
## 1156 46.98800     8.459764
## 1157 52.14300     9.270310
## 1158 57.36700     9.379943
## 1159 62.72800     9.469221
## 1160 67.73400     9.804508
## 1161 71.19700     9.831815
## 1162 72.49900     9.888478
## 1163 74.19300     9.892166
## 1164 75.64000    10.013068
## 1165 43.43600     6.528831
## 1166 45.55700     6.616177
## 1167 47.67000     6.688781
## 1168 49.80000     6.848439
## 1169 51.92900     6.956487
## 1170 54.04300     7.069807
## 1171 56.15800     7.274777
## 1172 58.24500     7.441137
## 1173 60.83800     7.586717
## 1174 61.81800     7.625278
## 1175 63.61000     7.646216
## 1176 65.48300     7.865552
## 1177 55.19100     7.816167
## 1178 59.20100     7.993553
## 1179 61.81700     8.170904
## 1180 64.07100     8.394123
## 1181 66.21600     8.587512
## 1182 68.68100     8.585209
## 1183 70.47200     8.855036
## 1184 71.52300     8.858622
## 1185 72.46200     8.797661
## 1186 73.73800     8.869777
## 1187 74.71200     8.903276
## 1188 75.53700     9.191075
## 1189 62.64900     7.576768
## 1190 63.19600     7.623718
## 1191 64.36100     7.672305
## 1192 64.95100     7.740393
## 1193 65.81500     7.833338
## 1194 66.35300     8.085910
## 1195 66.87400     8.356673
## 1196 67.37800     8.293769
## 1197 68.22500     8.341985
## 1198 69.40000     8.354062
## 1199 70.75500     8.238451
## 1200 71.75200     8.336352
## 1201 43.90200     8.231781
## 1202 46.26300     8.353558
## 1203 49.09600     8.508564
## 1204 51.44500     8.663558
## 1205 55.44800     8.689099
## 1206 58.44700     8.745331
## 1207 61.40600     8.769430
## 1208 64.13400     8.757932
## 1209 66.45800     8.399846
## 1210 68.38600     8.672203
## 1211 69.90600     8.684235
## 1212 71.42100     8.910438
## 1213 47.75200     7.149038
## 1214 51.33400     7.344683
## 1215 54.75700     7.408259
## 1216 56.39300     7.503360
## 1217 58.06500     7.595575
## 1218 60.06000     7.771996
## 1219 62.08200     7.864525
## 1220 64.15100     7.691490
## 1221 66.45800     7.731634
## 1222 68.56400     7.838554
## 1223 70.30300     7.882662
## 1224 71.68800     8.067927
## 1225 61.31000     8.301355
## 1226 65.77000     8.462579
## 1227 67.64000     8.582747
## 1228 69.61000     8.788312
## 1229 70.85000     8.988010
## 1230 70.67000     9.159904
## 1231 71.32000     9.042103
## 1232 70.98000     9.114088
## 1233 70.99000     8.954012
## 1234 72.75000     9.226173
## 1235 74.67000     9.392849
## 1236 75.56300     9.641468
## 1237 59.82000     8.028885
## 1238 61.51000     8.236042
## 1239 64.39000     8.461248
## 1240 66.60000     8.758022
## 1241 69.26000     9.107449
## 1242 70.41000     9.227442
## 1243 72.77000     9.371936
## 1244 74.06000     9.475724
## 1245 74.86000     9.693215
## 1246 75.97000     9.777983
## 1247 77.29000     9.902032
## 1248 78.09800     9.928651
## 1249 64.28000     8.033321
## 1250 68.54000     8.270565
## 1251 69.62000     8.538631
## 1252 71.10000     8.843511
## 1253 72.16000     9.118559
## 1254 73.44000     9.187125
## 1255 73.75000     9.242903
## 1256 74.63000     9.415836
## 1257 73.91100     9.591621
## 1258 74.91700     9.740935
## 1259 77.77800     9.844566
## 1260 78.74600     9.869347
## 1261 52.72400     7.907977
## 1262 55.09000     7.926405
## 1263 57.66600     8.062661
## 1264 60.54200     8.299330
## 1265 64.27400     8.526680
## 1266 67.06400     8.370965
## 1267 69.88500     8.569258
## 1268 71.91300     8.576099
## 1269 73.61500     8.716250
## 1270 74.77200     8.711434
## 1271 75.74400     8.750868
## 1272 76.44200     8.945088
## 1273 61.05000     8.053446
## 1274 64.10000     8.279791
## 1275 66.80000     8.462736
## 1276 66.80000     8.775065
## 1277 69.21000     8.988623
## 1278 69.46000     9.143816
## 1279 69.66000     9.170072
## 1280 69.53000     9.179497
## 1281 69.36000     8.794584
## 1282 69.72000     8.901986
## 1283 71.32200     8.972763
## 1284 72.47600     9.288086
## 1285 40.00000     6.201166
## 1286 41.50000     6.292105
## 1287 43.00000     6.392709
## 1288 44.10000     6.236299
## 1289 44.60000     6.381106
## 1290 45.00000     6.507398
## 1291 46.21800     6.781705
## 1292 44.02000     6.742870
## 1293 23.59900     6.602681
## 1294 36.08700     6.380028
## 1295 43.41300     6.666516
## 1296 46.24200     6.760517
## 1297 46.47100     6.779449
## 1298 48.94500     6.757789
## 1299 51.89300     6.976863
## 1300 54.42500     7.233340
## 1301 56.48000     7.334972
## 1302 58.55000     7.460238
## 1303 60.35100     7.544448
## 1304 61.72800     7.324177
## 1305 62.74200     7.264575
## 1306 63.30600     7.199735
## 1307 64.33700     7.210148
## 1308 65.52800     7.376780
## 1309 39.87500     8.773316
## 1310 42.86800     9.006704
## 1311 45.91400     9.361035
## 1312 49.90100     9.735249
## 1313 53.88600    10.120107
## 1314 58.69000    10.439038
## 1315 63.01200    10.425051
## 1316 66.29500     9.961674
## 1317 68.76800    10.120276
## 1318 70.53300     9.932400
## 1319 71.62600     9.852959
## 1320 72.77700     9.982984
## 1321 37.27800     7.279565
## 1322 39.32900     7.357335
## 1323 41.45400     7.411549
## 1324 43.56300     7.385482
## 1325 45.81500     7.376328
## 1326 48.87900     7.353575
## 1327 52.37900     7.325465
## 1328 55.76900     7.273593
## 1329 58.19600     7.221032
## 1330 60.18700     7.238761
## 1331 61.60000     7.326226
## 1332 63.06200     7.445693
## 1333 57.99600     8.183526
## 1334 61.68500     8.513404
## 1335 64.53100     8.746657
## 1336 66.91400     8.986160
## 1337 68.70000     9.261230
## 1338 70.30000     9.471217
## 1339 70.16200     9.627806
## 1340 71.21800     9.672241
## 1341 71.65900     9.140462
## 1342 72.23200     8.976429
## 1343 73.21300     8.886834
## 1344 74.00200     9.188763
## 1345 30.33100     6.779681
## 1346 31.57000     6.912230
## 1347 32.76700     7.018079
## 1348 34.11300     7.095100
## 1349 35.40000     7.210641
## 1350 36.78800     7.206589
## 1351 38.44500     7.289618
## 1352 40.00600     7.165839
## 1353 38.33300     6.974195
## 1354 39.89700     6.353758
## 1355 41.01200     6.550351
## 1356 42.56800     6.759882
## 1357 60.39600     7.747225
## 1358 63.17900     7.952652
## 1359 65.79800     8.209236
## 1360 67.94600     8.512667
## 1361 69.52100     9.059257
## 1362 70.79500     9.324569
## 1363 71.76000     9.627020
## 1364 73.56000     9.844880
## 1365 75.78800    10.117384
## 1366 77.15800    10.419882
## 1367 78.77000    10.491916
## 1368 79.97200    10.760945
## 1369 64.36000     8.532015
## 1370 67.45000     8.714939
## 1371 70.33000     8.920136
## 1372 70.98000     9.037522
## 1373 70.35000     9.177214
## 1374 70.45000     9.298595
## 1375 70.80000     9.336845
## 1376 71.08000     9.395763
## 1377 71.38000     9.158886
## 1378 72.71000     9.403126
## 1379 73.80000     9.520672
## 1380 74.66300     9.835118
## 1381 65.57000     8.346415
## 1382 67.85000     8.676293
## 1383 69.15000     8.909547
## 1384 69.18000     9.149049
## 1385 69.82000     9.424119
## 1386 70.97000     9.634106
## 1387 71.06300     9.790695
## 1388 72.25000     9.835130
## 1389 73.64000     9.562033
## 1390 75.13000     9.750401
## 1391 76.66000     9.935956
## 1392 77.92600    10.156899
## 1393 32.97800     7.035048
## 1394 34.97700     7.137396
## 1395 36.98100     7.222192
## 1396 38.97700     7.158306
## 1397 40.97300     7.134553
## 1398 41.97400     7.280003
## 1399 42.95500     7.070560
## 1400 44.50100     6.996906
## 1401 39.65800     6.831911
## 1402 43.79500     6.835826
## 1403 45.93600     6.782285
## 1404 48.15900     6.831027
## 1405 45.00900     8.460685
## 1406 47.98500     8.610156
## 1407 49.95100     8.660207
## 1408 51.92700     8.869887
## 1409 53.69600     8.957506
## 1410 55.52700     8.990772
## 1411 58.16100     9.055821
## 1412 60.83400     8.965184
## 1413 61.88800     8.885312
## 1414 60.23600     8.919880
## 1415 53.36500     8.950396
## 1416 49.33900     9.134502
## 1417 64.94000     8.251673
## 1418 66.66000     8.426131
## 1419 69.69000     8.647141
## 1420 71.44000     8.986386
## 1421 73.06000     9.272258
## 1422 74.39000     9.490765
## 1423 76.30000     9.541525
## 1424 76.90000     9.665547
## 1425 77.57000     9.831082
## 1426 78.77000     9.925508
## 1427 79.78000    10.120028
## 1428 80.94100    10.268862
## 1429 57.59300     6.987981
## 1430 61.45600     6.977791
## 1431 62.19200     6.979585
## 1432 64.26600     7.034841
## 1433 65.04200     7.101178
## 1434 65.94900     7.206953
## 1435 68.75700     7.407366
## 1436 69.01100     7.537306
## 1437 70.37900     7.674961
## 1438 70.45700     7.887763
## 1439 70.81500     8.011481
## 1440 72.39600     8.286545
## 1441 38.63500     7.387704
## 1442 39.62400     7.478925
## 1443 40.87000     7.580492
## 1444 42.85800     7.431298
## 1445 45.08300     7.414364
## 1446 47.80000     7.697570
## 1447 50.33800     7.547261
## 1448 51.74400     7.318420
## 1449 53.55600     7.308005
## 1450 55.37300     7.397691
## 1451 56.36900     7.597596
## 1452 58.55600     7.864187
## 1453 41.40700     7.046105
## 1454 43.42400     7.126657
## 1455 44.99200     7.526277
## 1456 46.63300     7.868293
## 1457 49.55200     8.121135
## 1458 52.53700     8.237852
## 1459 55.56100     8.267548
## 1460 57.67800     8.290252
## 1461 58.47400     8.175554
## 1462 54.28900     8.262757
## 1463 43.86900     8.325577
## 1464 39.61300     8.414824
## 1465 71.86000     9.051092
## 1466 72.49000     9.201489
## 1467 73.37000     9.419745
## 1468 74.16000     9.632879
## 1469 74.72000     9.788751
## 1470 75.44000     9.844572
## 1471 76.42000     9.936312
## 1472 77.19000    10.068448
## 1473 78.16000    10.080797
## 1474 79.39000    10.137238
## 1475 80.04000    10.286763
## 1476 80.88400    10.429982
## 1477 69.62000     9.597929
## 1478 70.56000     9.793086
## 1479 71.32000     9.924813
## 1480 72.77000    10.041776
## 1481 73.78000    10.210793
## 1482 75.39000    10.202936
## 1483 76.21000    10.254064
## 1484 77.41000    10.318299
## 1485 78.03000    10.369468
## 1486 79.37000    10.377711
## 1487 80.62000    10.448163
## 1488 81.70100    10.532267
## 1489 45.88300     7.404574
## 1490 48.28400     7.657866
## 1491 50.30500     7.693043
## 1492 53.65500     7.540050
## 1493 57.29600     7.852215
## 1494 61.19500     8.069494
## 1495 64.59000     8.232663
## 1496 66.97400     8.044554
## 1497 69.24900     8.113889
## 1498 71.52700     8.297603
## 1499 73.05300     8.316526
## 1500 74.14300     8.339154
## 1501 58.50000     7.095850
## 1502 62.40000     7.318448
## 1503 65.20000     7.508172
## 1504 67.50000     7.879995
## 1505 69.39000     8.309560
## 1506 70.59000     8.629900
## 1507 72.16000     8.912790
## 1508 73.40000     9.310598
## 1509 74.26000     9.630080
## 1510 75.25000     9.913775
## 1511 76.99000    10.053433
## 1512 78.40000    10.265289
## 1513 41.21500     6.574588
## 1514 42.97400     6.548986
## 1515 44.24600     6.582030
## 1516 45.75700     6.743138
## 1517 47.62000     6.820000
## 1518 49.91900     6.869526
## 1519 50.60800     6.773358
## 1520 51.53500     6.723619
## 1521 50.44000     6.716210
## 1522 48.46600     6.671002
## 1523 49.65100     6.801366
## 1524 52.51700     7.009844
## 1525 50.84800     6.630416
## 1526 53.63000     6.676551
## 1527 56.06100     6.909952
## 1528 58.28500     7.166622
## 1529 60.40500     7.329329
## 1530 62.49400     7.581324
## 1531 64.59700     7.780395
## 1532 66.08400     8.000569
## 1533 67.29800     8.437478
## 1534 67.52100     8.674646
## 1535 68.56400     8.684940
## 1536 70.61600     8.917096
## 1537 38.59600     6.756710
## 1538 41.20800     6.830775
## 1539 43.92200     6.973107
## 1540 46.76900     7.298172
## 1541 49.75900     7.408325
## 1542 52.88700     7.334836
## 1543 55.47100     7.203835
## 1544 56.94100     7.091910
## 1545 58.06100     6.941479
## 1546 58.39000     6.889883
## 1547 57.56100     6.786966
## 1548 58.42000     6.783291
## 1549 59.10000     8.014095
## 1550 61.80000     8.318838
## 1551 64.90000     8.516698
## 1552 65.40000     8.634330
## 1553 65.90000     8.797783
## 1554 68.30000     8.974562
## 1555 68.83200     9.118173
## 1556 69.58200     8.907693
## 1557 69.86200     8.905307
## 1558 69.46500     9.081663
## 1559 68.97600     9.346670
## 1560 69.81900     9.798600
## 1561 44.60000     7.291980
## 1562 47.10000     7.240816
## 1563 49.57900     7.414756
## 1564 52.05300     7.566497
## 1565 55.60200     7.920550
## 1566 59.83700     8.045869
## 1567 64.04800     8.177581
## 1568 66.89400     8.245495
## 1569 70.00100     8.373951
## 1570 71.97300     8.492244
## 1571 73.04200     8.652230
## 1572 73.92300     8.866853
## 1573 43.58500     7.585332
## 1574 48.07900     7.704701
## 1575 52.09800     7.750559
## 1576 54.33600     7.946744
## 1577 57.00500     8.146331
## 1578 59.50700     8.359164
## 1579 61.03600     8.352638
## 1580 63.10800     8.534845
## 1581 66.14600     8.644416
## 1582 68.83500     8.795042
## 1583 70.84500     8.780801
## 1584 71.77700     9.042901
## 1585 39.97800     6.599535
## 1586 42.57100     6.652051
## 1587 45.34400     6.642841
## 1588 48.05100     6.812255
## 1589 51.01600     6.857236
## 1590 50.35000     6.737836
## 1591 49.84900     6.525420
## 1592 51.50900     6.426042
## 1593 48.82500     6.467964
## 1594 44.57800     6.705099
## 1595 47.81300     6.832731
## 1596 51.54200     6.962603
## 1597 69.18000     9.208289
## 1598 70.42000     9.331068
## 1599 70.76000     9.431656
## 1600 71.36000     9.556965
## 1601 72.01000     9.673767
## 1602 72.76000     9.765876
## 1603 74.04000     9.810957
## 1604 75.00700     9.983444
## 1605 76.42000    10.030345
## 1606 77.21800    10.168714
## 1607 78.47100    10.291433
## 1608 79.42500    10.410403
## 1609 68.44000     9.546133
## 1610 69.49000     9.605562
## 1611 70.21000     9.691107
## 1612 70.76000     9.879726
## 1613 71.34000     9.989942
## 1614 73.38000    10.088831
## 1615 74.65000    10.127013
## 1616 75.02000    10.305090
## 1617 76.09000    10.373614
## 1618 76.81000    10.484793
## 1619 77.31000    10.573804
## 1620 78.24200    10.667830
## 1621 66.07100     8.651159
## 1622 67.04400     8.724333
## 1623 68.25300     8.631121
## 1624 68.46800     8.602383
## 1625 68.67300     8.648819
## 1626 69.48100     8.780225
## 1627 70.80500     8.842203
## 1628 71.91800     8.916291
## 1629 72.75200     9.004177
## 1630 74.22300     9.130240
## 1631 75.30700     8.952476
## 1632 76.38400     9.269690
## 1633 55.08800     8.947650
## 1634 57.90700     9.190389
## 1635 60.77000     9.038718
## 1636 63.47900     9.163403
## 1637 65.71200     9.259631
## 1638 67.45600     9.483717
## 1639 68.55700     9.319411
## 1640 70.19000     9.198631
## 1641 71.15000     9.281165
## 1642 72.14600     9.226754
## 1643 72.76600     9.060104
## 1644 73.74700     9.342754
## 1645 40.41200     6.405338
## 1646 42.88700     6.516615
## 1647 45.36300     6.649048
## 1648 47.83800     6.456963
## 1649 50.25400     6.550368
## 1650 55.76400     6.570234
## 1651 58.81600     6.561364
## 1652 62.82000     6.710279
## 1653 67.66200     6.896718
## 1654 70.67200     7.234103
## 1655 73.01700     7.475598
## 1656 74.24900     7.800399
## 1657 43.16000     7.323562
## 1658 45.67100     7.510468
## 1659 48.12700     7.695738
## 1660 51.63100     7.882207
## 1661 56.53200     8.049877
## 1662 60.76500     8.211437
## 1663 64.40600     8.374715
## 1664 67.04600     8.538406
## 1665 69.71800     8.702453
## 1666 71.09600     8.869351
## 1667 72.37000     8.415268
## 1668 73.42200     8.014782
## 1669 32.54800     6.661494
## 1670 33.97000     6.690632
## 1671 35.18000     6.716138
## 1672 36.98400     6.759768
## 1673 39.84800     7.142865
## 1674 44.17500     7.511943
## 1675 49.11300     7.589618
## 1676 52.92200     7.586672
## 1677 55.59900     7.538759
## 1678 58.02000     7.657984
## 1679 60.30800     7.711916
## 1680 62.69800     7.732268
## 1681 42.03800     7.045244
## 1682 44.07700     7.179275
## 1683 46.02300     7.281197
## 1684 47.76800     7.482725
## 1685 50.10700     7.480709
## 1686 51.38600     7.370664
## 1687 51.82100     7.250407
## 1688 50.82100     7.101112
## 1689 46.10000     7.099106
## 1690 40.23800     6.976678
## 1691 39.19300     6.976921
## 1692 42.38400     7.147726
## 1693 48.45100     6.008528
## 1694 50.46900     6.251450
## 1695 52.35800     6.267717
## 1696 53.99500     6.345277
## 1697 55.63500     6.683814
## 1698 57.67400     6.530276
## 1699 60.36300     6.670583
## 1700 62.35100     6.559838
## 1701 60.37700     6.541637
## 1702 46.80900     6.675129
## 1703 39.98900     6.510316
## 1704 43.48700     6.152114
```


---

### Presenting Models


```r
stargazer::stargazer(mod,type = "text")
```

```
## 
## ===============================================
##                         Dependent variable:    
##                     ---------------------------
##                               lifeExp          
## -----------------------------------------------
## ln_gdpPercap                 8.405***          
##                               (0.149)          
##                                                
## Constant                     -9.101***         
##                               (1.228)          
##                                                
## -----------------------------------------------
## Observations                   1,704           
## R2                             0.652           
## Adjusted R2                    0.652           
## Residual Std. Error      7.620 (df = 1702)     
## F Statistic         3,192.273*** (df = 1; 1702)
## ===============================================
## Note:               *p&lt;0.1; **p&lt;0.05; ***p&lt;0.01
```

---

### Presenting Models

`stargazer` offers a number of different formats for presenting model output.


```r
stargazer::stargazer(mod,type = "text")

stargazer::stargazer(mod,type = "latex")

stargazer::stargazer(mod,type = "html")
```



---

class:newsection

# Pre-Processing Data

---

### Feature Cleaning 

We've already talked about **data manipulation**.

- raw data to **tidy** data
- transform the **unit of analysis**
- **class** management (e.g. characters to dates)

--

&lt;br&gt;

However, often our variables exist on different scales, which can complicate machine learning and statistics tasks.

By complicate, I mean it can make **optimization problems intractable**. 

---

### Feature Cleaning 

Feature (or variable) cleaning it the process of curating a **design matrix** for a machine learning or modeling task. 

&lt;br&gt;

&gt; In statistics, a **design matrix** (also known as regressor matrix or model matrix) is a matrix of values of explanatory variables of a set of objects, often denoted by X. Each row represents an individual object, with the successive columns corresponding to the variables and their specific values for that object.

&lt;br&gt;

This is known as data **pre-processing** the data.

---

### Feature Cleaning 




```r
D %&gt;% ggplot(aes(x,y)) + geom_point()
```

&lt;img src="lecture-week-06_EDA-and-Modeling_ppol670_files/figure-html/unnamed-chunk-48-1.png" style="display: block; margin: auto;" /&gt;


---

### Feature Cleaning 



```r
D %&gt;% 
  gather(var,val) %&gt;% 
  ggplot(aes(val,fill=var)) + geom_density()
```

&lt;img src="lecture-week-06_EDA-and-Modeling_ppol670_files/figure-html/unnamed-chunk-49-1.png" style="display: block; margin: auto;" /&gt;

---

### Feature Cleaning 

Variables at different scales can impact estimation. The coefficient estimates are scaled down (i.e. a unit change in x has a really really small unit change in y). 


```r
lm(y~x,data=D) %&gt;% 
  coef(.) %&gt;% 
  round(.,6)
```

```
## (Intercept)           x 
##   -0.921649    0.000002
```


---

### Scaling

**scaling** is the process of transforming our data so that it all falls within the same numerical range. Below `x` is transformed to have a mean of `0` and a variance of `1`.


```r
D %&gt;% 
  mutate(x = scale(x)) %&gt;% 
  gather(var,val) %&gt;% 
  ggplot(aes(val,fill=var)) +geom_density(alpha=.5)
```

&lt;img src="lecture-week-06_EDA-and-Modeling_ppol670_files/figure-html/unnamed-chunk-51-1.png" style="display: block; margin: auto;" /&gt;

---

### Scaling

**scaling** is the process of transforming our data so that it all falls within the same numerical range. Below `x` is transformed to have a mean of `0` and a variance of `1`.


```r
D %&gt;% 
* mutate(x = (x-mean(x))/sd(x) ) %&gt;%
  gather(var,val) %&gt;% 
  ggplot(aes(val,fill=var)) +geom_density(alpha=.5)
```

&lt;img src="lecture-week-06_EDA-and-Modeling_ppol670_files/figure-html/unnamed-chunk-52-1.png" style="display: block; margin: auto;" /&gt;

---

### Scaling

The scaled versions of our variables behave better. 


```r
D %&gt;% 
  mutate(x = (x-mean(x))/sd(x) ) %&gt;%
  lm(y~x,data=.) %&gt;% 
  coef(.) %&gt;% 
  round(.,3)
```

```
## (Intercept)           x 
##       0.000       0.899
```

---

### Data preprocessing

&lt;br&gt;&lt;br&gt;

Common pre-processing tasks:

- **Scaling** and transforming continuous values 

- Converting categorical variables to **dummy** variables.

- Detecting and **imputing** missing values


---

### `recipes()` package


.pull-left[
&lt;br&gt;&lt;br&gt;
.center[&lt;img src="Figures/recipes_hex_thumb.png",width=700&gt;]
]

.pull-right[
[`recipes`](https://tidymodels.github.io/recipes/) package is an alternative method for creating and preprocessing design matrices that can be used for modeling or visualization.


The idea of the `recipes` package is to define a recipe or blueprint that can be used to sequentially define the encodings and preprocessing of the data (i.e. “feature engineering”).
]


---

### `recipes()` package

.pull-left[
&lt;br&gt;&lt;br&gt;
.center[&lt;img src="Figures/recipes_hex_thumb.png"&gt;]
]
.pull-right[
The basic setup of `recipes()`:

- Initialize a recipe object

- Specify the transformation steps

- Estimates the required quantities and statistics required by any operations.

- Apply the transformations 
]

---

### Data 

Data on whether a person will pay back a bank loan. The outcome variable is `status`. 13 other variables track features about the debtor and the loan. (See `?credit_data` for more details.)


```r
data("credit_data") # Load data (from recipes package)
glimpse(credit_data)
```

```
## Observations: 4,454
## Variables: 14
## $ Status    &lt;fct&gt; good, good, bad, good, good, good, good, good, good, b…
## $ Seniority &lt;int&gt; 9, 17, 10, 0, 0, 1, 29, 9, 0, 0, 6, 7, 8, 19, 0, 0, 15…
## $ Home      &lt;fct&gt; rent, rent, owner, rent, rent, owner, owner, parents, …
## $ Time      &lt;int&gt; 60, 60, 36, 60, 36, 60, 60, 12, 60, 48, 48, 36, 60, 36…
## $ Age       &lt;int&gt; 30, 58, 46, 24, 26, 36, 44, 27, 32, 41, 34, 29, 30, 37…
## $ Marital   &lt;fct&gt; married, widow, married, single, single, married, marr…
## $ Records   &lt;fct&gt; no, no, yes, no, no, no, no, no, no, no, no, no, no, n…
## $ Job       &lt;fct&gt; freelance, fixed, freelance, fixed, fixed, fixed, fixe…
## $ Expenses  &lt;int&gt; 73, 48, 90, 63, 46, 75, 75, 35, 90, 90, 60, 60, 75, 75…
## $ Income    &lt;int&gt; 129, 131, 200, 182, 107, 214, 125, 80, 107, 80, 125, 1…
## $ Assets    &lt;int&gt; 0, 0, 3000, 2500, 0, 3500, 10000, 0, 15000, 0, 4000, 3…
## $ Debt      &lt;int&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 2500, 260, 0, 0, 0…
## $ Amount    &lt;int&gt; 800, 1000, 2000, 900, 310, 650, 1600, 200, 1200, 1200,…
## $ Price     &lt;int&gt; 846, 1658, 2985, 1325, 910, 1645, 1800, 1093, 1957, 14…
```

---

Variables of different types


```r
credit_data %&gt;% 
  summarize_all(class) %&gt;% 
  glimpse()
```

```
## Observations: 1
## Variables: 14
## $ Status    &lt;chr&gt; "factor"
## $ Seniority &lt;chr&gt; "integer"
## $ Home      &lt;chr&gt; "factor"
## $ Time      &lt;chr&gt; "integer"
## $ Age       &lt;chr&gt; "integer"
## $ Marital   &lt;chr&gt; "factor"
## $ Records   &lt;chr&gt; "factor"
## $ Job       &lt;chr&gt; "factor"
## $ Expenses  &lt;chr&gt; "integer"
## $ Income    &lt;chr&gt; "integer"
## $ Assets    &lt;chr&gt; "integer"
## $ Debt      &lt;chr&gt; "integer"
## $ Amount    &lt;chr&gt; "integer"
## $ Price     &lt;chr&gt; "integer"
```

---

Variables on different scales... with some missing values!


```r
credit_data %&gt;% 
* summarize_if(is.numeric, function(x) mean(x)) %&gt;%
  glimpse()
```

```
## Observations: 1
## Variables: 9
## $ Seniority &lt;dbl&gt; 7.986753
## $ Time      &lt;dbl&gt; 46.43871
## $ Age       &lt;dbl&gt; 37.08038
## $ Expenses  &lt;dbl&gt; 55.57342
## $ Income    &lt;dbl&gt; NA
## $ Assets    &lt;dbl&gt; NA
## $ Debt      &lt;dbl&gt; NA
## $ Amount    &lt;dbl&gt; 1038.918
## $ Price     &lt;dbl&gt; 1462.78
```

---

Variables on different scales... 


```r
credit_data %&gt;% 
  summarize_if(is.numeric, function(x) mean(x,na.rm = T)) %&gt;% 
  glimpse()
```

```
## Observations: 1
## Variables: 9
## $ Seniority &lt;dbl&gt; 7.986753
## $ Time      &lt;dbl&gt; 46.43871
## $ Age       &lt;dbl&gt; 37.08038
## $ Expenses  &lt;dbl&gt; 55.57342
## $ Income    &lt;dbl&gt; 141.6877
## $ Assets    &lt;dbl&gt; 5403.979
## $ Debt      &lt;dbl&gt; 343.0259
## $ Amount    &lt;dbl&gt; 1038.918
## $ Price     &lt;dbl&gt; 1462.78
```

---

Categorical variables...


```r
credit_data %&gt;% 
  select_if(is.factor) %&gt;% 
  glimpse()
```

```
## Observations: 4,454
## Variables: 5
## $ Status  &lt;fct&gt; good, good, bad, good, good, good, good, good, good, bad…
## $ Home    &lt;fct&gt; rent, rent, owner, rent, rent, owner, owner, parents, ow…
## $ Marital &lt;fct&gt; married, widow, married, single, single, married, marrie…
## $ Records &lt;fct&gt; no, no, yes, no, no, no, no, no, no, no, no, no, no, no,…
## $ Job     &lt;fct&gt; freelance, fixed, freelance, fixed, fixed, fixed, fixed,…
```


```r
credit_data %&gt;% 
  select_if(is.factor) %&gt;% 
  summarize_all(function(x) sum(is.na(x)))
```

```
##   Status Home Marital Records Job
## 1      0    6       1       0   2
```

---

### Building a recipe

The package operates by laying out a series of steps that are then itemized. Once we have all our steps in place we then `bake` the recipe (i.e. execute and transform the data all at once).

&lt;br&gt; 

`step_`s we need to perform:

1. imput any missing values.

2. scale the continuous variables

3. convert the categorical variables to dummy variables


---

### Building a recipe

First, let's initialize the recipe object. 


```r
our_recipe &lt;- recipe(Status ~ ., data = credit_data)
our_recipe
```

```
## Data Recipe
## 
## Inputs:
## 
##       role #variables
##    outcome          1
##  predictor         13
```

---

### (1) Imput any missing values

`recipes` offers many different forms of imputation.

&lt;br&gt; 

.center[
&lt;table class="table" style="margin-left: auto; margin-right: auto;"&gt;
 &lt;thead&gt;
  &lt;tr&gt;
   &lt;th style="text-align:left;"&gt; Imputation Methods &lt;/th&gt;
  &lt;/tr&gt;
 &lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; step_bagimpute &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; step_knnimpute &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; step_lowerimpute &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; step_meanimpute &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; step_medianimpute &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; step_modeimpute &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; step_rollimpute &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
]

---

### (1) Imput any missing values

`recipes` offers many different forms of imputation.


```r
our_recipe &lt;-
  our_recipe %&gt;% 
  step_knnimpute(all_predictors())
our_recipe
```

```
## Data Recipe
## 
## Inputs:
## 
##       role #variables
##    outcome          1
##  predictor         13
## 
## Operations:
## 
## 5-nearest neighbor imputation for all_predictors()
```

---

### (2) Scale the continuous variables


```r
our_recipe &lt;-
  our_recipe %&gt;% 
  step_center(all_numeric()) %&gt;% # Center mean around 0
  step_scale(all_numeric()) # Set variance to 1
our_recipe
```

```
## Data Recipe
## 
## Inputs:
## 
##       role #variables
##    outcome          1
##  predictor         13
## 
## Operations:
## 
## 5-nearest neighbor imputation for all_predictors()
## Centering for all_numeric()
## Scaling for all_numeric()
```

---

### (3) Convert the categories to dummies


```r
our_recipe &lt;- 
  our_recipe %&gt;% 
  step_dummy(all_nominal())
our_recipe
```

```
## Data Recipe
## 
## Inputs:
## 
##       role #variables
##    outcome          1
##  predictor         13
## 
## Operations:
## 
## 5-nearest neighbor imputation for all_predictors()
## Centering for all_numeric()
## Scaling for all_numeric()
## Dummy variables from all_nominal()
```

---

### Prepare the recipe

&lt;!-- Need to calculate all the necessary statistics and values for the transformations.  --&gt;


```r
prepared_recipe &lt;- our_recipe %&gt;% prep()
prepared_recipe
```

```
## Data Recipe
## 
## Inputs:
## 
##       role #variables
##    outcome          1
##  predictor         13
## 
## Training data contained 4454 data points and 415 incomplete rows. 
## 
## Operations:
## 
## 5-nearest neighbor imputation for Home, Time, Age, Marital, Records, ... [trained]
## Centering for Seniority, Time, Age, Expenses, ... [trained]
## Scaling for Seniority, Time, Age, Expenses, ... [trained]
## Dummy variables from Home, Marital, Records, Job, Status [trained]
```


---

### Bake!

&lt;!-- Now that the recipe is prepared... we can apply it to our data. --&gt;


```r
glimpse(credit_data) # Before
```

```
## Observations: 4,454
## Variables: 14
## $ Status    &lt;fct&gt; good, good, bad, good, good, good, good, good, good, b…
## $ Seniority &lt;int&gt; 9, 17, 10, 0, 0, 1, 29, 9, 0, 0, 6, 7, 8, 19, 0, 0, 15…
## $ Home      &lt;fct&gt; rent, rent, owner, rent, rent, owner, owner, parents, …
## $ Time      &lt;int&gt; 60, 60, 36, 60, 36, 60, 60, 12, 60, 48, 48, 36, 60, 36…
## $ Age       &lt;int&gt; 30, 58, 46, 24, 26, 36, 44, 27, 32, 41, 34, 29, 30, 37…
## $ Marital   &lt;fct&gt; married, widow, married, single, single, married, marr…
## $ Records   &lt;fct&gt; no, no, yes, no, no, no, no, no, no, no, no, no, no, n…
## $ Job       &lt;fct&gt; freelance, fixed, freelance, fixed, fixed, fixed, fixe…
## $ Expenses  &lt;int&gt; 73, 48, 90, 63, 46, 75, 75, 35, 90, 90, 60, 60, 75, 75…
## $ Income    &lt;int&gt; 129, 131, 200, 182, 107, 214, 125, 80, 107, 80, 125, 1…
## $ Assets    &lt;int&gt; 0, 0, 3000, 2500, 0, 3500, 10000, 0, 15000, 0, 4000, 3…
## $ Debt      &lt;int&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 2500, 260, 0, 0, 0…
## $ Amount    &lt;int&gt; 800, 1000, 2000, 900, 310, 650, 1600, 200, 1200, 1200,…
## $ Price     &lt;int&gt; 846, 1658, 2985, 1325, 910, 1645, 1800, 1093, 1957, 14…
```

---

### Bake!


```r
dat_processed &lt;- bake(prepared_recipe,new_data = credit_data)
glimpse(dat_processed) # After
```

```
## Observations: 4,454
## Variables: 23
## $ Seniority         &lt;dbl&gt; 0.123955057, 1.102631460, 0.246289608, -0.9770…
## $ Time              &lt;dbl&gt; 0.9253405, 0.9253405, -0.7122742, 0.9253405, -…
## $ Age               &lt;dbl&gt; -0.644573149, 1.904450396, 0.812011734, -1.190…
## $ Expenses          &lt;dbl&gt; 0.8929550, -0.3880692, 1.7640514, 0.3805453, -…
## $ Income            &lt;dbl&gt; -0.16098875, -0.13553594, 0.74258608, 0.513510…
## $ Assets            &lt;dbl&gt; -0.47046400, -0.47046400, -0.21049460, -0.2538…
## $ Debt              &lt;dbl&gt; -0.27568376, -0.27568376, -0.27568376, -0.2756…
## $ Amount            &lt;dbl&gt; -0.5034671, -0.0820116, 2.0252657, -0.2927393,…
## $ Price             &lt;dbl&gt; -0.981933746, 0.310796152, 2.423422475, -0.219…
## $ Home_other        &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0…
## $ Home_owner        &lt;dbl&gt; 0, 0, 1, 0, 0, 1, 1, 0, 1, 0, 1, 1, 1, 0, 0, 1…
## $ Home_parents      &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 1, 0, 1, 0, 0, 0, 0, 0, 0…
## $ Home_priv         &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0…
## $ Home_rent         &lt;dbl&gt; 1, 1, 0, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0…
## $ Marital_married   &lt;dbl&gt; 1, 0, 1, 0, 0, 1, 1, 0, 1, 1, 1, 1, 1, 1, 0, 1…
## $ Marital_separated &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0…
## $ Marital_single    &lt;dbl&gt; 0, 0, 0, 1, 1, 0, 0, 1, 0, 0, 0, 0, 0, 0, 1, 0…
## $ Marital_widow     &lt;dbl&gt; 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0…
## $ Records_yes       &lt;dbl&gt; 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0…
## $ Job_freelance     &lt;dbl&gt; 1, 0, 1, 0, 0, 0, 0, 0, 1, 0, 1, 0, 0, 0, 0, 0…
## $ Job_others        &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0…
## $ Job_partime       &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0…
## $ Status_good       &lt;dbl&gt; 1, 1, 0, 1, 1, 1, 1, 1, 1, 0, 1, 1, 1, 1, 0, 1…
```

---

&lt;br&gt;
.pull-left[

```r
credit_data %&gt;% 
  ggplot(aes(Seniority)) +
  geom_density(fill="pink",
               alpha=.5)
```

&lt;img src="lecture-week-06_EDA-and-Modeling_ppol670_files/figure-html/unnamed-chunk-68-1.png" style="display: block; margin: auto;" /&gt;
]

.pull-right[

```r
dat_processed %&gt;% 
  ggplot(aes(Seniority)) +
  geom_density(fill="pink",
               alpha=.5)
```

&lt;img src="lecture-week-06_EDA-and-Modeling_ppol670_files/figure-html/unnamed-chunk-69-1.png" style="display: block; margin: auto;" /&gt;
]


---

### `recipe()`

&lt;br&gt;
`recipe()` provides a way to systematically transform our data and apply it to any _new_ versions of the data.

&lt;br&gt;

This becomes really important when pre-processing **training data** that we then need to apply to **test data** in order to calculate our out of sample predictions (more on this later!)

&lt;br&gt; 

The `prep()` function allows us to use the same statistics (like the mean when centering) that we used to process the old and new data. 

Then `bake()` allows allows us to seemlessly and implement those steps.
    </textarea>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script>var slideshow = remark.create({
"highlightStyle": "github",
"countIncrementalSlides": false,
"highlightLines": true
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function() {
  var d = document, s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})();</script>

<script>
(function() {
  var i, text, code, codes = document.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
})();
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
