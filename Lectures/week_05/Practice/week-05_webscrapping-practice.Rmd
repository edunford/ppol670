---
title: "PPOL670 | Webscraping Practice"
output: html_document
---


```{r}
require(tidyverse)
require(rvest)
require(xml2)
```

# Target

The following `url` contains data regarding all bilateral investment treaties made between two states. The data is maintained by the United Nations and reflects trade networks both cross nationally and over time. 

```{r}
url <- "http://investmentpolicyhub.unctad.org/IIA/IiasByCountry#iiaInnerMenu"
```

# Task 1

Scrape the data from the html table at the provided url. Make sure the data is formatted correctly. Change the variable names to `country`, `total_bits`, and `total_tips`. Drop the `No.` column. 


# Task 2 

Examine the webpage at the provided url. You'll note that if you click on country names there is a link to the specific trade agreement that the country enters into and with whom. This data is valuable if one wanted to build a network of international investment treaties. 

Use the provided links to build a dataset of all bilateral investment treaties between two states. 

```{r}
# Following code extracts all the country links for you. 
range <- 1:233 
country_links <- rep(NA,233)
for(i in 1:233){ #233 countries
   link <- 
    raw %>% 
    html_nodes(.,xpath=str_glue("//*[@id='country-list']/tbody/tr[{i}]/td[2]/span/a")) %>%
    html_attr("href")
   country_links[i] <- paste0("http://investmentpolicyhub.unctad.org",link)
}
```


